<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>pynever.strategies.training API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../strategies.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pynever.strategies</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger_name">logger_name</a>
            </li>
            <li>
                    <a class="class" href="#TrainingStrategy">TrainingStrategy</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TrainingStrategy.train">train</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TestingStrategy">TestingStrategy</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TestingStrategy.test">test</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PytorchTraining">PytorchTraining</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PytorchTraining.__init__">PytorchTraining</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.optimizer_con">optimizer_con</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.opt_params">opt_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.scheduler_con">scheduler_con</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.sch_params">sch_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.loss_function">loss_function</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.precision_metric">precision_metric</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.n_epochs">n_epochs</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.validation_percentage">validation_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.train_batch_size">train_batch_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.validation_batch_size">validation_batch_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.r_split">r_split</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.network_transform">network_transform</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.device">device</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.train_patience">train_patience</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.verbose_rate">verbose_rate</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTraining.checkpoints_root">checkpoints_root</a>
                        </li>
                        <li>
                                <a class="function" href="#PytorchTraining.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#PytorchTraining.pytorch_training">pytorch_training</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PytorchTesting">PytorchTesting</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PytorchTesting.__init__">PytorchTesting</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTesting.metric">metric</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTesting.metric_params">metric_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTesting.test_batch_size">test_batch_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTesting.device">device</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTesting.mps">mps</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchTesting.save_results">save_results</a>
                        </li>
                        <li>
                                <a class="function" href="#PytorchTesting.test">test</a>
                        </li>
                        <li>
                                <a class="function" href="#PytorchTesting.pytorch_testing">pytorch_testing</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PytorchMetrics">PytorchMetrics</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PytorchMetrics.inaccuracy">inaccuracy</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../pynever.html">pynever</a><wbr>.<a href="./../strategies.html">strategies</a><wbr>.training    </h1>

                
                        <input id="mod-training-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-training-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">abc</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">torch.optim.lr_scheduler</span> <span class="k">as</span> <span class="nn">schedulers</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">torch.utils.data</span> <span class="k">as</span> <span class="nn">tdt</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">pynever.datasets</span> <span class="k">as</span> <span class="nn">datasets</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span> <span class="nn">pynever.networks</span> <span class="k">as</span> <span class="nn">networks</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span> <span class="nn">pynever.strategies.conversion</span> <span class="k">as</span> <span class="nn">cv</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">logger_name</span> <span class="o">=</span> <span class="s2">&quot;pynever.strategies.training&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">TrainingStrategy</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    An abstract class used to represent a Training Strategy.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Methods</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    ----------</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    train(NeuralNetwork, Dataset)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">        Train the neural network of interest using a training strategy determined in the concrete children.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">:</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        Train the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        Parameters</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        ----------</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        network : NeuralNetwork</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            The neural network to train.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">            The dataset to use to train the neural network.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">        Returns</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        ----------</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        NeuralNetwork</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">            The Neural Network resulting from the training of the original network using the training strategy and the</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">            dataset.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="k">pass</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="k">class</span> <span class="nc">TestingStrategy</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    An abstract class used to represent a Testing Strategy.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    Methods</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    ----------</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    test(NeuralNetwork, Dataset)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        Test the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        Test the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        Parameters</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        ----------</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        network : NeuralNetwork</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">            The neural network to test.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            The dataset to use to test the neural network.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        Returns</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        ----------</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        float</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            A measure of the correctness of the networks dependant on the concrete children</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="k">pass</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="k">class</span> <span class="nc">PytorchTraining</span><span class="p">(</span><span class="n">TrainingStrategy</span><span class="p">):</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    Class used to represent the training strategy based on the Pytorch learning framework.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    It supports different optimization algorithm, schedulers, loss function and others based on</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    the attributes provided at instantiation time.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    Attributes</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    ----------</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    optimizer_con : type</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        Reference to the class constructor for the Optimizer of choice for the training strategy.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    opt_params : Dict</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        Dictionary of the parameters to pass to the constructor of the optimizer excluding the first which is always</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        assumed to be the parameters to optimize</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    loss_function : Callable</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        Loss function for the training strategy. We assume it to take as parameters two pytorch Tensor</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        corresponding to the output of the network and the target. Other parameter should be given as attribute of</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        the callable object.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    n_epochs : int</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Number of epochs for the training procedure.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    validation_percentage : float</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Percentage of the dataset to use as the validation set</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    train_batch_size : int</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        Dimension for the train batch size for the training procedure</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    validation_batch_size : int</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        Dimension for the validation batch size for the training procedure</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">    scheduler_con : type, Optional</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        Reference to the class constructor for the Scheduler for the learning rate of choice for the training strategy</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        (default: None)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">    sch_params : Dict, Optional</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        Dictionary of the parameters to pass to the constructor of the scheduler excluding the first which is always</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        assumed to be the optimizer whose learning rate must be updated. (default: None)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    precision_metric : Callable, Optional</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        Function for measuring the precision of the neural network. It is used to choose the best model and to control</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        the Plateau Scheduler and the early stopping. We assume it to take as parameters two pytorch Tensor</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        corresponding to the output of the network and the target.It should produce a float value and such value should</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        decrease for increasing correctness of the network (as the traditional loss value).</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        Optional supplementary parameters should be given as attributes of the object. (default: None)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    network_transform : Callable, Optional</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        We provide the possibility to define a function which will be applied to the network after</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        the computation of backward and before the optimizer step. In practice we use it for the manipulation</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        needed to the pruning oriented training. It should take a pytorch module (i.e., the neural network) as</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        input and optional supplementary parameters () should be given as attributes of the object. (default: None)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">    cuda : bool, Optional</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        Whether to use the cuda library for the procedure (default: False).</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    train_patience : int, Optional</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        The number of epochs in which the loss may not decrease before the</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        training procedure is interrupted with early stopping (default: None).</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">    checkpoints_root : str, Optional</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        Where to store the checkpoints of the training strategy. (default: &#39;&#39;)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    verbose_rate : int, Optional</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        After how many batch the strategy prints information about how the training is going.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimizer_con</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">opt_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">loss_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                 <span class="n">validation_percentage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">train_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">validation_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r_split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                 <span class="n">scheduler_con</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sch_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">precision_metric</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                 <span class="n">network_transform</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">train_patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                 <span class="n">checkpoints_root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="n">TrainingStrategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_con</span> <span class="o">=</span> <span class="n">optimizer_con</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">opt_params</span> <span class="o">=</span> <span class="n">opt_params</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span> <span class="o">=</span> <span class="n">scheduler_con</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sch_params</span> <span class="o">=</span> <span class="n">sch_params</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span> <span class="o">=</span> <span class="n">loss_function</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="k">if</span> <span class="n">precision_metric</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="n">precision_metric</span> <span class="o">=</span> <span class="n">loss_function</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision_metric</span> <span class="o">=</span> <span class="n">precision_metric</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span> <span class="o">=</span> <span class="n">n_epochs</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validation_percentage</span> <span class="o">=</span> <span class="n">validation_percentage</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="n">train_batch_size</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validation_batch_size</span> <span class="o">=</span> <span class="n">validation_batch_size</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r_split</span> <span class="o">=</span> <span class="n">r_split</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span> <span class="o">=</span> <span class="n">network_transform</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="k">assert</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;mps&#39;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">train_patience</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="n">train_patience</span> <span class="o">=</span> <span class="n">n_epochs</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_patience</span> <span class="o">=</span> <span class="n">train_patience</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">=</span> <span class="n">verbose_rate</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">=</span> <span class="n">checkpoints_root</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="c1"># Sanitize checkpoints root as a path</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">pytorch_converter</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchConverter</span><span class="p">()</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="n">pytorch_converter</span><span class="o">.</span><span class="n">from_neural_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_training</span><span class="p">(</span><span class="n">py_net</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">alt_rep_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">alt_rep_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">py_net</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">up_to_date</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">return</span> <span class="n">network</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">pytorch_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Training procedure for the PyTorchNetwork.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        Parameters</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        ----------</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        net : PyTorchNetwork</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            The PyTorchNetwork to train.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">            The dataset to use for the training of the PyTorchNetwork</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        Returns</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        ----------</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        PyTorchNetwork</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">            The trained PyTorchNetwork.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="c1"># We set the model to the opportune device.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="c1"># We build the optimizer and the scheduler</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_con</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_params</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="n">scheduler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sch_params</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="n">scheduler</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="c1"># We split the dataset in training set and validation set.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="n">validation_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_percentage</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="n">training_len</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">-</span> <span class="n">validation_len</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_split</span><span class="p">:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="n">training_set</span><span class="p">,</span> <span class="n">validation_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">random_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">training_len</span><span class="p">,</span> <span class="n">validation_len</span><span class="p">))</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="n">training_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_len</span><span class="p">))</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">validation_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_len</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="c1"># We instantiate the data loaders</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">training_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">validation_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_batch_size</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="c1"># If a checkpoint exist, we load the checkpoint of interest</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">checkpoints_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="n">net</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="s1">&#39;.pth.tar&#39;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">best_model_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="n">net</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="s1">&#39;_best.pth.tar&#39;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading Checkpoint: &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;network_state_dict&#39;</span><span class="p">])</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">])</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">best_loss_score</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;best_loss_score&#39;</span><span class="p">]</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epochs_without_decrease&#39;</span><span class="p">]</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded Checkpoint: &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">start_epoch</span><span class="si">}</span><span class="s2">, Best Loss Score: </span><span class="si">{</span><span class="n">best_loss_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="c1"># Otherwise we initialize the values of interest</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Checkpoint was found at &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="c1"># best_loss_score is set to a high number so that the first epoch will replace it</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="n">best_loss_score</span> <span class="o">=</span> <span class="mi">999999</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="n">start_epoch</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="c1"># history_score is used to keep track of the evolution of training loss and validation loss</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">history_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span> <span class="o">-</span> <span class="n">start_epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="c1"># We begin the real and proper training of the network. In the outer cycle we consider the epochs and for each</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="c1"># epochs until termination we consider all the batches</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_epoch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span><span class="p">):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="n">epochs_without_decrease</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_patience</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="k">break</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="c1"># We set all the values of the network to double.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="c1"># net.pytorch_network.double()</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="c1"># We set the network to train mode.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>            <span class="n">avg_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="c1"># For each batch we compute one learning step</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                <span class="n">avg_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Train Epoch: </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{:.1f}</span><span class="s1">%)]</span><span class="se">\t</span><span class="s1">Loss: </span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                        <span class="n">epoch</span><span class="p">,</span> <span class="n">batch_idx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="p">),</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                               <span class="mf">100.</span> <span class="o">*</span> <span class="n">batch_idx</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span><span class="p">),</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                        <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="c1"># avg_loss = avg_loss / float(math.floor(len(training_set) / self.train_batch_size))</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">avg_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="n">history_score</span><span class="p">[</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_loss</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="c1"># EPOCH TEST</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">validation_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">validation_loader</span><span class="p">):</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                    <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                    <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision_metric</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                    <span class="n">validation_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="c1"># validation_loss = validation_loss / float(math.floor(len(validation_set) / self.validation_batch_size))</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="n">validation_loss</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Validation Set Metric Value: </span><span class="si">{:.4f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">validation_loss</span><span class="p">))</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="n">validation_loss</span> <span class="o">&lt;</span> <span class="n">best_loss_score</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                <span class="n">best_loss_score</span> <span class="o">=</span> <span class="n">validation_loss</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="n">epochs_without_decrease</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="c1"># We need to distinguish among different scheduler because not all the pytorch scheduler present the same</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="c1"># interface.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="k">if</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scheduler</span><span class="p">,</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                    <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">validation_loss</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                <span class="k">elif</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                    <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="c1"># CHECKPOINT</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">history_score</span><span class="p">[</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_loss</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="n">is_best</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">&lt;</span> <span class="n">best_loss_score</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>                <span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                <span class="s1">&#39;network_state_dict&#39;</span><span class="p">:</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                <span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">:</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                <span class="s1">&#39;best_loss_score&#39;</span><span class="p">:</span> <span class="n">best_loss_score</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                <span class="s1">&#39;epochs_without_decrease&#39;</span><span class="p">:</span> <span class="n">epochs_without_decrease</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="p">}</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">checkpoints_path</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="k">if</span> <span class="n">is_best</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">,</span> <span class="n">best_model_path</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">):</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="n">best_checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">best_checkpoint</span><span class="p">[</span><span class="s1">&#39;network_state_dict&#39;</span><span class="p">])</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Loss Score: </span><span class="si">{</span><span class="n">best_loss_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="k">return</span> <span class="n">net</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="k">class</span> <span class="nc">PytorchTesting</span><span class="p">(</span><span class="n">TestingStrategy</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">    Class used to represent the testing strategy based on the Pytorch learning framework.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">    It supports different metrics measure for the correctness of the neural network.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">    Attributes</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">    ----------</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">    metric : Callable</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        Function for measuring the precision/correctness of the neural network.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">    metric_params : Dict</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        Supplementary parameters for the metric other than the output and the target (which should always be the first</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        two parameters of the metric. It is assumed that it produce a float value and such value</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        decrease for increasing correctness of the network (as the traditional loss value).</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">    test_batch_size : int</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        Dimension for the test batch size for the testing procedure</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">    cuda : bool, Optional</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        Whether to use the cuda library for the procedure (default: False).</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">    save_results : bool, Optional</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        Whether to save outputs, targets and losses as attributes.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">metric_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">test_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                 <span class="n">save_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="n">TestingStrategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric_params</span> <span class="o">=</span> <span class="n">metric_params</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_batch_size</span> <span class="o">=</span> <span class="n">test_batch_size</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="k">assert</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;mps&#39;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mps</span> <span class="o">=</span> <span class="n">mps</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="n">save_results</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="n">pytorch_converter</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchConverter</span><span class="p">()</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="n">pytorch_converter</span><span class="o">.</span><span class="n">from_neural_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="n">measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_testing</span><span class="p">(</span><span class="n">py_net</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="k">return</span> <span class="n">measure</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="k">def</span> <span class="nf">pytorch_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="c1"># We set all the values of the network to double.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="c1"># We instantiate the data loader</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">test_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_batch_size</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">):</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_params</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>                <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="c1"># test_loss = test_loss / float(math.floor(len(dataset)) / self.test_batch_size)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">test_loss</span> <span class="o">=</span> <span class="n">test_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="n">test_loss</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="k">class</span> <span class="nc">PytorchMetrics</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="nf">inaccuracy</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        Function to compute the inaccuracy of a prediction. It assumes that the task is classification, the output is</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        a Tensor of shape (n, d) where d is the number of possible classes. The target is a Tensor of shape (n, 1) of</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        int whose elements correspond to the correct class for the n-th sample. The index of the output element with</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        the greater value (considering the n-th Tensor) correspond to the class predicted. We consider the inaccuracy</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        metric instead than the accuracy because our metric functions must follow the rule: &quot;lower value equals to</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        better network&quot; like the loss functions.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        Parameters</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        ----------</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        output : torch.Tensor</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">            Output predicted by the network. It should be a Tensor of shape (n, d)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        target : torch.Tensor</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">            Correct class for the prediction. It should be a Tensor of shape (n, 1)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">        Returns</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">        -------</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">        float</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">            Number of correct prediction / number of sample analyzed</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="n">pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="n">acc</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_as</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">acc</span>
</span></pre></div>


            </section>
                <section id="logger_name">
                    <div class="attr variable">
            <span class="name">logger_name</span>        =
<span class="default_value">&#39;<a href="">pynever.strategies.training</a>&#39;</span>

        
    </div>
    <a class="headerlink" href="#logger_name"></a>
    
    

                </section>
                <section id="TrainingStrategy">
                            <input id="TrainingStrategy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TrainingStrategy</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="TrainingStrategy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TrainingStrategy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TrainingStrategy-21"><a href="#TrainingStrategy-21"><span class="linenos">21</span></a><span class="k">class</span> <span class="nc">TrainingStrategy</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="TrainingStrategy-22"><a href="#TrainingStrategy-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TrainingStrategy-23"><a href="#TrainingStrategy-23"><span class="linenos">23</span></a><span class="sd">    An abstract class used to represent a Training Strategy.</span>
</span><span id="TrainingStrategy-24"><a href="#TrainingStrategy-24"><span class="linenos">24</span></a>
</span><span id="TrainingStrategy-25"><a href="#TrainingStrategy-25"><span class="linenos">25</span></a><span class="sd">    Methods</span>
</span><span id="TrainingStrategy-26"><a href="#TrainingStrategy-26"><span class="linenos">26</span></a><span class="sd">    ----------</span>
</span><span id="TrainingStrategy-27"><a href="#TrainingStrategy-27"><span class="linenos">27</span></a><span class="sd">    train(NeuralNetwork, Dataset)</span>
</span><span id="TrainingStrategy-28"><a href="#TrainingStrategy-28"><span class="linenos">28</span></a><span class="sd">        Train the neural network of interest using a training strategy determined in the concrete children.</span>
</span><span id="TrainingStrategy-29"><a href="#TrainingStrategy-29"><span class="linenos">29</span></a>
</span><span id="TrainingStrategy-30"><a href="#TrainingStrategy-30"><span class="linenos">30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TrainingStrategy-31"><a href="#TrainingStrategy-31"><span class="linenos">31</span></a>
</span><span id="TrainingStrategy-32"><a href="#TrainingStrategy-32"><span class="linenos">32</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="TrainingStrategy-33"><a href="#TrainingStrategy-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">:</span>
</span><span id="TrainingStrategy-34"><a href="#TrainingStrategy-34"><span class="linenos">34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TrainingStrategy-35"><a href="#TrainingStrategy-35"><span class="linenos">35</span></a><span class="sd">        Train the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="TrainingStrategy-36"><a href="#TrainingStrategy-36"><span class="linenos">36</span></a>
</span><span id="TrainingStrategy-37"><a href="#TrainingStrategy-37"><span class="linenos">37</span></a><span class="sd">        Parameters</span>
</span><span id="TrainingStrategy-38"><a href="#TrainingStrategy-38"><span class="linenos">38</span></a><span class="sd">        ----------</span>
</span><span id="TrainingStrategy-39"><a href="#TrainingStrategy-39"><span class="linenos">39</span></a><span class="sd">        network : NeuralNetwork</span>
</span><span id="TrainingStrategy-40"><a href="#TrainingStrategy-40"><span class="linenos">40</span></a><span class="sd">            The neural network to train.</span>
</span><span id="TrainingStrategy-41"><a href="#TrainingStrategy-41"><span class="linenos">41</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="TrainingStrategy-42"><a href="#TrainingStrategy-42"><span class="linenos">42</span></a><span class="sd">            The dataset to use to train the neural network.</span>
</span><span id="TrainingStrategy-43"><a href="#TrainingStrategy-43"><span class="linenos">43</span></a>
</span><span id="TrainingStrategy-44"><a href="#TrainingStrategy-44"><span class="linenos">44</span></a><span class="sd">        Returns</span>
</span><span id="TrainingStrategy-45"><a href="#TrainingStrategy-45"><span class="linenos">45</span></a><span class="sd">        ----------</span>
</span><span id="TrainingStrategy-46"><a href="#TrainingStrategy-46"><span class="linenos">46</span></a><span class="sd">        NeuralNetwork</span>
</span><span id="TrainingStrategy-47"><a href="#TrainingStrategy-47"><span class="linenos">47</span></a><span class="sd">            The Neural Network resulting from the training of the original network using the training strategy and the</span>
</span><span id="TrainingStrategy-48"><a href="#TrainingStrategy-48"><span class="linenos">48</span></a><span class="sd">            dataset.</span>
</span><span id="TrainingStrategy-49"><a href="#TrainingStrategy-49"><span class="linenos">49</span></a>
</span><span id="TrainingStrategy-50"><a href="#TrainingStrategy-50"><span class="linenos">50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TrainingStrategy-51"><a href="#TrainingStrategy-51"><span class="linenos">51</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>An abstract class used to represent a Training Strategy.</p>

<h2 id="methods">Methods</h2>

<p>train(NeuralNetwork, Dataset)
    Train the neural network of interest using a training strategy determined in the concrete children.</p>
</div>


                            <div id="TrainingStrategy.train" class="classattr">
                                        <input id="TrainingStrategy.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">network</span><span class="p">:</span> <span class="n"><a href="../networks.html#NeuralNetwork">pynever.networks.NeuralNetwork</a></span>,</span><span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="n"><a href="../datasets.html#Dataset">pynever.datasets.Dataset</a></span></span><span class="return-annotation">) -> <span class="n"><a href="../networks.html#NeuralNetwork">pynever.networks.NeuralNetwork</a></span>:</span></span>

                <label class="view-source-button" for="TrainingStrategy.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TrainingStrategy.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TrainingStrategy.train-32"><a href="#TrainingStrategy.train-32"><span class="linenos">32</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="TrainingStrategy.train-33"><a href="#TrainingStrategy.train-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">:</span>
</span><span id="TrainingStrategy.train-34"><a href="#TrainingStrategy.train-34"><span class="linenos">34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TrainingStrategy.train-35"><a href="#TrainingStrategy.train-35"><span class="linenos">35</span></a><span class="sd">        Train the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="TrainingStrategy.train-36"><a href="#TrainingStrategy.train-36"><span class="linenos">36</span></a>
</span><span id="TrainingStrategy.train-37"><a href="#TrainingStrategy.train-37"><span class="linenos">37</span></a><span class="sd">        Parameters</span>
</span><span id="TrainingStrategy.train-38"><a href="#TrainingStrategy.train-38"><span class="linenos">38</span></a><span class="sd">        ----------</span>
</span><span id="TrainingStrategy.train-39"><a href="#TrainingStrategy.train-39"><span class="linenos">39</span></a><span class="sd">        network : NeuralNetwork</span>
</span><span id="TrainingStrategy.train-40"><a href="#TrainingStrategy.train-40"><span class="linenos">40</span></a><span class="sd">            The neural network to train.</span>
</span><span id="TrainingStrategy.train-41"><a href="#TrainingStrategy.train-41"><span class="linenos">41</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="TrainingStrategy.train-42"><a href="#TrainingStrategy.train-42"><span class="linenos">42</span></a><span class="sd">            The dataset to use to train the neural network.</span>
</span><span id="TrainingStrategy.train-43"><a href="#TrainingStrategy.train-43"><span class="linenos">43</span></a>
</span><span id="TrainingStrategy.train-44"><a href="#TrainingStrategy.train-44"><span class="linenos">44</span></a><span class="sd">        Returns</span>
</span><span id="TrainingStrategy.train-45"><a href="#TrainingStrategy.train-45"><span class="linenos">45</span></a><span class="sd">        ----------</span>
</span><span id="TrainingStrategy.train-46"><a href="#TrainingStrategy.train-46"><span class="linenos">46</span></a><span class="sd">        NeuralNetwork</span>
</span><span id="TrainingStrategy.train-47"><a href="#TrainingStrategy.train-47"><span class="linenos">47</span></a><span class="sd">            The Neural Network resulting from the training of the original network using the training strategy and the</span>
</span><span id="TrainingStrategy.train-48"><a href="#TrainingStrategy.train-48"><span class="linenos">48</span></a><span class="sd">            dataset.</span>
</span><span id="TrainingStrategy.train-49"><a href="#TrainingStrategy.train-49"><span class="linenos">49</span></a>
</span><span id="TrainingStrategy.train-50"><a href="#TrainingStrategy.train-50"><span class="linenos">50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TrainingStrategy.train-51"><a href="#TrainingStrategy.train-51"><span class="linenos">51</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Train the neural network of interest using a testing strategy determined in the concrete children.</p>

<h2 id="parameters">Parameters</h2>

<p>network : NeuralNetwork
    The neural network to train.
dataset : Dataset
    The dataset to use to train the neural network.</p>

<h2 id="returns">Returns</h2>

<p>NeuralNetwork
    The Neural Network resulting from the training of the original network using the training strategy and the
    dataset.</p>
</div>


                            </div>
                </section>
                <section id="TestingStrategy">
                            <input id="TestingStrategy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TestingStrategy</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="TestingStrategy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TestingStrategy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TestingStrategy-54"><a href="#TestingStrategy-54"><span class="linenos">54</span></a><span class="k">class</span> <span class="nc">TestingStrategy</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="TestingStrategy-55"><a href="#TestingStrategy-55"><span class="linenos">55</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TestingStrategy-56"><a href="#TestingStrategy-56"><span class="linenos">56</span></a><span class="sd">    An abstract class used to represent a Testing Strategy.</span>
</span><span id="TestingStrategy-57"><a href="#TestingStrategy-57"><span class="linenos">57</span></a>
</span><span id="TestingStrategy-58"><a href="#TestingStrategy-58"><span class="linenos">58</span></a><span class="sd">    Methods</span>
</span><span id="TestingStrategy-59"><a href="#TestingStrategy-59"><span class="linenos">59</span></a><span class="sd">    ----------</span>
</span><span id="TestingStrategy-60"><a href="#TestingStrategy-60"><span class="linenos">60</span></a><span class="sd">    test(NeuralNetwork, Dataset)</span>
</span><span id="TestingStrategy-61"><a href="#TestingStrategy-61"><span class="linenos">61</span></a><span class="sd">        Test the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="TestingStrategy-62"><a href="#TestingStrategy-62"><span class="linenos">62</span></a>
</span><span id="TestingStrategy-63"><a href="#TestingStrategy-63"><span class="linenos">63</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TestingStrategy-64"><a href="#TestingStrategy-64"><span class="linenos">64</span></a>
</span><span id="TestingStrategy-65"><a href="#TestingStrategy-65"><span class="linenos">65</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="TestingStrategy-66"><a href="#TestingStrategy-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="TestingStrategy-67"><a href="#TestingStrategy-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TestingStrategy-68"><a href="#TestingStrategy-68"><span class="linenos">68</span></a><span class="sd">        Test the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="TestingStrategy-69"><a href="#TestingStrategy-69"><span class="linenos">69</span></a>
</span><span id="TestingStrategy-70"><a href="#TestingStrategy-70"><span class="linenos">70</span></a><span class="sd">        Parameters</span>
</span><span id="TestingStrategy-71"><a href="#TestingStrategy-71"><span class="linenos">71</span></a><span class="sd">        ----------</span>
</span><span id="TestingStrategy-72"><a href="#TestingStrategy-72"><span class="linenos">72</span></a><span class="sd">        network : NeuralNetwork</span>
</span><span id="TestingStrategy-73"><a href="#TestingStrategy-73"><span class="linenos">73</span></a><span class="sd">            The neural network to test.</span>
</span><span id="TestingStrategy-74"><a href="#TestingStrategy-74"><span class="linenos">74</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="TestingStrategy-75"><a href="#TestingStrategy-75"><span class="linenos">75</span></a><span class="sd">            The dataset to use to test the neural network.</span>
</span><span id="TestingStrategy-76"><a href="#TestingStrategy-76"><span class="linenos">76</span></a>
</span><span id="TestingStrategy-77"><a href="#TestingStrategy-77"><span class="linenos">77</span></a><span class="sd">        Returns</span>
</span><span id="TestingStrategy-78"><a href="#TestingStrategy-78"><span class="linenos">78</span></a><span class="sd">        ----------</span>
</span><span id="TestingStrategy-79"><a href="#TestingStrategy-79"><span class="linenos">79</span></a><span class="sd">        float</span>
</span><span id="TestingStrategy-80"><a href="#TestingStrategy-80"><span class="linenos">80</span></a><span class="sd">            A measure of the correctness of the networks dependant on the concrete children</span>
</span><span id="TestingStrategy-81"><a href="#TestingStrategy-81"><span class="linenos">81</span></a>
</span><span id="TestingStrategy-82"><a href="#TestingStrategy-82"><span class="linenos">82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TestingStrategy-83"><a href="#TestingStrategy-83"><span class="linenos">83</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>An abstract class used to represent a Testing Strategy.</p>

<h2 id="methods">Methods</h2>

<p>test(NeuralNetwork, Dataset)
    Test the neural network of interest using a testing strategy determined in the concrete children.</p>
</div>


                            <div id="TestingStrategy.test" class="classattr">
                                        <input id="TestingStrategy.test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">test</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">network</span><span class="p">:</span> <span class="n"><a href="../networks.html#NeuralNetwork">pynever.networks.NeuralNetwork</a></span>,</span><span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="n"><a href="../datasets.html#Dataset">pynever.datasets.Dataset</a></span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="TestingStrategy.test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TestingStrategy.test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TestingStrategy.test-65"><a href="#TestingStrategy.test-65"><span class="linenos">65</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="TestingStrategy.test-66"><a href="#TestingStrategy.test-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="TestingStrategy.test-67"><a href="#TestingStrategy.test-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TestingStrategy.test-68"><a href="#TestingStrategy.test-68"><span class="linenos">68</span></a><span class="sd">        Test the neural network of interest using a testing strategy determined in the concrete children.</span>
</span><span id="TestingStrategy.test-69"><a href="#TestingStrategy.test-69"><span class="linenos">69</span></a>
</span><span id="TestingStrategy.test-70"><a href="#TestingStrategy.test-70"><span class="linenos">70</span></a><span class="sd">        Parameters</span>
</span><span id="TestingStrategy.test-71"><a href="#TestingStrategy.test-71"><span class="linenos">71</span></a><span class="sd">        ----------</span>
</span><span id="TestingStrategy.test-72"><a href="#TestingStrategy.test-72"><span class="linenos">72</span></a><span class="sd">        network : NeuralNetwork</span>
</span><span id="TestingStrategy.test-73"><a href="#TestingStrategy.test-73"><span class="linenos">73</span></a><span class="sd">            The neural network to test.</span>
</span><span id="TestingStrategy.test-74"><a href="#TestingStrategy.test-74"><span class="linenos">74</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="TestingStrategy.test-75"><a href="#TestingStrategy.test-75"><span class="linenos">75</span></a><span class="sd">            The dataset to use to test the neural network.</span>
</span><span id="TestingStrategy.test-76"><a href="#TestingStrategy.test-76"><span class="linenos">76</span></a>
</span><span id="TestingStrategy.test-77"><a href="#TestingStrategy.test-77"><span class="linenos">77</span></a><span class="sd">        Returns</span>
</span><span id="TestingStrategy.test-78"><a href="#TestingStrategy.test-78"><span class="linenos">78</span></a><span class="sd">        ----------</span>
</span><span id="TestingStrategy.test-79"><a href="#TestingStrategy.test-79"><span class="linenos">79</span></a><span class="sd">        float</span>
</span><span id="TestingStrategy.test-80"><a href="#TestingStrategy.test-80"><span class="linenos">80</span></a><span class="sd">            A measure of the correctness of the networks dependant on the concrete children</span>
</span><span id="TestingStrategy.test-81"><a href="#TestingStrategy.test-81"><span class="linenos">81</span></a>
</span><span id="TestingStrategy.test-82"><a href="#TestingStrategy.test-82"><span class="linenos">82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TestingStrategy.test-83"><a href="#TestingStrategy.test-83"><span class="linenos">83</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Test the neural network of interest using a testing strategy determined in the concrete children.</p>

<h2 id="parameters">Parameters</h2>

<p>network : NeuralNetwork
    The neural network to test.
dataset : Dataset
    The dataset to use to test the neural network.</p>

<h2 id="returns">Returns</h2>

<p>float
    A measure of the correctness of the networks dependant on the concrete children</p>
</div>


                            </div>
                </section>
                <section id="PytorchTraining">
                            <input id="PytorchTraining-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PytorchTraining</span><wbr>(<span class="base"><a href="#TrainingStrategy">TrainingStrategy</a></span>):

                <label class="view-source-button" for="PytorchTraining-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTraining"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTraining-86"><a href="#PytorchTraining-86"><span class="linenos"> 86</span></a><span class="k">class</span> <span class="nc">PytorchTraining</span><span class="p">(</span><span class="n">TrainingStrategy</span><span class="p">):</span>
</span><span id="PytorchTraining-87"><a href="#PytorchTraining-87"><span class="linenos"> 87</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PytorchTraining-88"><a href="#PytorchTraining-88"><span class="linenos"> 88</span></a><span class="sd">    Class used to represent the training strategy based on the Pytorch learning framework.</span>
</span><span id="PytorchTraining-89"><a href="#PytorchTraining-89"><span class="linenos"> 89</span></a><span class="sd">    It supports different optimization algorithm, schedulers, loss function and others based on</span>
</span><span id="PytorchTraining-90"><a href="#PytorchTraining-90"><span class="linenos"> 90</span></a><span class="sd">    the attributes provided at instantiation time.</span>
</span><span id="PytorchTraining-91"><a href="#PytorchTraining-91"><span class="linenos"> 91</span></a>
</span><span id="PytorchTraining-92"><a href="#PytorchTraining-92"><span class="linenos"> 92</span></a><span class="sd">    Attributes</span>
</span><span id="PytorchTraining-93"><a href="#PytorchTraining-93"><span class="linenos"> 93</span></a><span class="sd">    ----------</span>
</span><span id="PytorchTraining-94"><a href="#PytorchTraining-94"><span class="linenos"> 94</span></a><span class="sd">    optimizer_con : type</span>
</span><span id="PytorchTraining-95"><a href="#PytorchTraining-95"><span class="linenos"> 95</span></a><span class="sd">        Reference to the class constructor for the Optimizer of choice for the training strategy.</span>
</span><span id="PytorchTraining-96"><a href="#PytorchTraining-96"><span class="linenos"> 96</span></a>
</span><span id="PytorchTraining-97"><a href="#PytorchTraining-97"><span class="linenos"> 97</span></a><span class="sd">    opt_params : Dict</span>
</span><span id="PytorchTraining-98"><a href="#PytorchTraining-98"><span class="linenos"> 98</span></a><span class="sd">        Dictionary of the parameters to pass to the constructor of the optimizer excluding the first which is always</span>
</span><span id="PytorchTraining-99"><a href="#PytorchTraining-99"><span class="linenos"> 99</span></a><span class="sd">        assumed to be the parameters to optimize</span>
</span><span id="PytorchTraining-100"><a href="#PytorchTraining-100"><span class="linenos">100</span></a>
</span><span id="PytorchTraining-101"><a href="#PytorchTraining-101"><span class="linenos">101</span></a><span class="sd">    loss_function : Callable</span>
</span><span id="PytorchTraining-102"><a href="#PytorchTraining-102"><span class="linenos">102</span></a><span class="sd">        Loss function for the training strategy. We assume it to take as parameters two pytorch Tensor</span>
</span><span id="PytorchTraining-103"><a href="#PytorchTraining-103"><span class="linenos">103</span></a><span class="sd">        corresponding to the output of the network and the target. Other parameter should be given as attribute of</span>
</span><span id="PytorchTraining-104"><a href="#PytorchTraining-104"><span class="linenos">104</span></a><span class="sd">        the callable object.</span>
</span><span id="PytorchTraining-105"><a href="#PytorchTraining-105"><span class="linenos">105</span></a>
</span><span id="PytorchTraining-106"><a href="#PytorchTraining-106"><span class="linenos">106</span></a><span class="sd">    n_epochs : int</span>
</span><span id="PytorchTraining-107"><a href="#PytorchTraining-107"><span class="linenos">107</span></a><span class="sd">        Number of epochs for the training procedure.</span>
</span><span id="PytorchTraining-108"><a href="#PytorchTraining-108"><span class="linenos">108</span></a>
</span><span id="PytorchTraining-109"><a href="#PytorchTraining-109"><span class="linenos">109</span></a><span class="sd">    validation_percentage : float</span>
</span><span id="PytorchTraining-110"><a href="#PytorchTraining-110"><span class="linenos">110</span></a><span class="sd">        Percentage of the dataset to use as the validation set</span>
</span><span id="PytorchTraining-111"><a href="#PytorchTraining-111"><span class="linenos">111</span></a>
</span><span id="PytorchTraining-112"><a href="#PytorchTraining-112"><span class="linenos">112</span></a><span class="sd">    train_batch_size : int</span>
</span><span id="PytorchTraining-113"><a href="#PytorchTraining-113"><span class="linenos">113</span></a><span class="sd">        Dimension for the train batch size for the training procedure</span>
</span><span id="PytorchTraining-114"><a href="#PytorchTraining-114"><span class="linenos">114</span></a>
</span><span id="PytorchTraining-115"><a href="#PytorchTraining-115"><span class="linenos">115</span></a><span class="sd">    validation_batch_size : int</span>
</span><span id="PytorchTraining-116"><a href="#PytorchTraining-116"><span class="linenos">116</span></a><span class="sd">        Dimension for the validation batch size for the training procedure</span>
</span><span id="PytorchTraining-117"><a href="#PytorchTraining-117"><span class="linenos">117</span></a>
</span><span id="PytorchTraining-118"><a href="#PytorchTraining-118"><span class="linenos">118</span></a><span class="sd">    scheduler_con : type, Optional</span>
</span><span id="PytorchTraining-119"><a href="#PytorchTraining-119"><span class="linenos">119</span></a><span class="sd">        Reference to the class constructor for the Scheduler for the learning rate of choice for the training strategy</span>
</span><span id="PytorchTraining-120"><a href="#PytorchTraining-120"><span class="linenos">120</span></a><span class="sd">        (default: None)</span>
</span><span id="PytorchTraining-121"><a href="#PytorchTraining-121"><span class="linenos">121</span></a>
</span><span id="PytorchTraining-122"><a href="#PytorchTraining-122"><span class="linenos">122</span></a><span class="sd">    sch_params : Dict, Optional</span>
</span><span id="PytorchTraining-123"><a href="#PytorchTraining-123"><span class="linenos">123</span></a><span class="sd">        Dictionary of the parameters to pass to the constructor of the scheduler excluding the first which is always</span>
</span><span id="PytorchTraining-124"><a href="#PytorchTraining-124"><span class="linenos">124</span></a><span class="sd">        assumed to be the optimizer whose learning rate must be updated. (default: None)</span>
</span><span id="PytorchTraining-125"><a href="#PytorchTraining-125"><span class="linenos">125</span></a>
</span><span id="PytorchTraining-126"><a href="#PytorchTraining-126"><span class="linenos">126</span></a><span class="sd">    precision_metric : Callable, Optional</span>
</span><span id="PytorchTraining-127"><a href="#PytorchTraining-127"><span class="linenos">127</span></a><span class="sd">        Function for measuring the precision of the neural network. It is used to choose the best model and to control</span>
</span><span id="PytorchTraining-128"><a href="#PytorchTraining-128"><span class="linenos">128</span></a><span class="sd">        the Plateau Scheduler and the early stopping. We assume it to take as parameters two pytorch Tensor</span>
</span><span id="PytorchTraining-129"><a href="#PytorchTraining-129"><span class="linenos">129</span></a><span class="sd">        corresponding to the output of the network and the target.It should produce a float value and such value should</span>
</span><span id="PytorchTraining-130"><a href="#PytorchTraining-130"><span class="linenos">130</span></a><span class="sd">        decrease for increasing correctness of the network (as the traditional loss value).</span>
</span><span id="PytorchTraining-131"><a href="#PytorchTraining-131"><span class="linenos">131</span></a><span class="sd">        Optional supplementary parameters should be given as attributes of the object. (default: None)</span>
</span><span id="PytorchTraining-132"><a href="#PytorchTraining-132"><span class="linenos">132</span></a>
</span><span id="PytorchTraining-133"><a href="#PytorchTraining-133"><span class="linenos">133</span></a><span class="sd">    network_transform : Callable, Optional</span>
</span><span id="PytorchTraining-134"><a href="#PytorchTraining-134"><span class="linenos">134</span></a><span class="sd">        We provide the possibility to define a function which will be applied to the network after</span>
</span><span id="PytorchTraining-135"><a href="#PytorchTraining-135"><span class="linenos">135</span></a><span class="sd">        the computation of backward and before the optimizer step. In practice we use it for the manipulation</span>
</span><span id="PytorchTraining-136"><a href="#PytorchTraining-136"><span class="linenos">136</span></a><span class="sd">        needed to the pruning oriented training. It should take a pytorch module (i.e., the neural network) as</span>
</span><span id="PytorchTraining-137"><a href="#PytorchTraining-137"><span class="linenos">137</span></a><span class="sd">        input and optional supplementary parameters () should be given as attributes of the object. (default: None)</span>
</span><span id="PytorchTraining-138"><a href="#PytorchTraining-138"><span class="linenos">138</span></a>
</span><span id="PytorchTraining-139"><a href="#PytorchTraining-139"><span class="linenos">139</span></a><span class="sd">    cuda : bool, Optional</span>
</span><span id="PytorchTraining-140"><a href="#PytorchTraining-140"><span class="linenos">140</span></a><span class="sd">        Whether to use the cuda library for the procedure (default: False).</span>
</span><span id="PytorchTraining-141"><a href="#PytorchTraining-141"><span class="linenos">141</span></a>
</span><span id="PytorchTraining-142"><a href="#PytorchTraining-142"><span class="linenos">142</span></a><span class="sd">    train_patience : int, Optional</span>
</span><span id="PytorchTraining-143"><a href="#PytorchTraining-143"><span class="linenos">143</span></a><span class="sd">        The number of epochs in which the loss may not decrease before the</span>
</span><span id="PytorchTraining-144"><a href="#PytorchTraining-144"><span class="linenos">144</span></a><span class="sd">        training procedure is interrupted with early stopping (default: None).</span>
</span><span id="PytorchTraining-145"><a href="#PytorchTraining-145"><span class="linenos">145</span></a>
</span><span id="PytorchTraining-146"><a href="#PytorchTraining-146"><span class="linenos">146</span></a><span class="sd">    checkpoints_root : str, Optional</span>
</span><span id="PytorchTraining-147"><a href="#PytorchTraining-147"><span class="linenos">147</span></a><span class="sd">        Where to store the checkpoints of the training strategy. (default: &#39;&#39;)</span>
</span><span id="PytorchTraining-148"><a href="#PytorchTraining-148"><span class="linenos">148</span></a>
</span><span id="PytorchTraining-149"><a href="#PytorchTraining-149"><span class="linenos">149</span></a><span class="sd">    verbose_rate : int, Optional</span>
</span><span id="PytorchTraining-150"><a href="#PytorchTraining-150"><span class="linenos">150</span></a><span class="sd">        After how many batch the strategy prints information about how the training is going.</span>
</span><span id="PytorchTraining-151"><a href="#PytorchTraining-151"><span class="linenos">151</span></a>
</span><span id="PytorchTraining-152"><a href="#PytorchTraining-152"><span class="linenos">152</span></a>
</span><span id="PytorchTraining-153"><a href="#PytorchTraining-153"><span class="linenos">153</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PytorchTraining-154"><a href="#PytorchTraining-154"><span class="linenos">154</span></a>
</span><span id="PytorchTraining-155"><a href="#PytorchTraining-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimizer_con</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">opt_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">loss_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PytorchTraining-156"><a href="#PytorchTraining-156"><span class="linenos">156</span></a>                 <span class="n">validation_percentage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">train_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">validation_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r_split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PytorchTraining-157"><a href="#PytorchTraining-157"><span class="linenos">157</span></a>                 <span class="n">scheduler_con</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sch_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">precision_metric</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PytorchTraining-158"><a href="#PytorchTraining-158"><span class="linenos">158</span></a>                 <span class="n">network_transform</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">train_patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PytorchTraining-159"><a href="#PytorchTraining-159"><span class="linenos">159</span></a>                 <span class="n">checkpoints_root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PytorchTraining-160"><a href="#PytorchTraining-160"><span class="linenos">160</span></a>
</span><span id="PytorchTraining-161"><a href="#PytorchTraining-161"><span class="linenos">161</span></a>        <span class="n">TrainingStrategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="PytorchTraining-162"><a href="#PytorchTraining-162"><span class="linenos">162</span></a>
</span><span id="PytorchTraining-163"><a href="#PytorchTraining-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_con</span> <span class="o">=</span> <span class="n">optimizer_con</span>
</span><span id="PytorchTraining-164"><a href="#PytorchTraining-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">opt_params</span> <span class="o">=</span> <span class="n">opt_params</span>
</span><span id="PytorchTraining-165"><a href="#PytorchTraining-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span> <span class="o">=</span> <span class="n">scheduler_con</span>
</span><span id="PytorchTraining-166"><a href="#PytorchTraining-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sch_params</span> <span class="o">=</span> <span class="n">sch_params</span>
</span><span id="PytorchTraining-167"><a href="#PytorchTraining-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span> <span class="o">=</span> <span class="n">loss_function</span>
</span><span id="PytorchTraining-168"><a href="#PytorchTraining-168"><span class="linenos">168</span></a>
</span><span id="PytorchTraining-169"><a href="#PytorchTraining-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">precision_metric</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-170"><a href="#PytorchTraining-170"><span class="linenos">170</span></a>            <span class="n">precision_metric</span> <span class="o">=</span> <span class="n">loss_function</span>
</span><span id="PytorchTraining-171"><a href="#PytorchTraining-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision_metric</span> <span class="o">=</span> <span class="n">precision_metric</span>
</span><span id="PytorchTraining-172"><a href="#PytorchTraining-172"><span class="linenos">172</span></a>
</span><span id="PytorchTraining-173"><a href="#PytorchTraining-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span> <span class="o">=</span> <span class="n">n_epochs</span>
</span><span id="PytorchTraining-174"><a href="#PytorchTraining-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validation_percentage</span> <span class="o">=</span> <span class="n">validation_percentage</span>
</span><span id="PytorchTraining-175"><a href="#PytorchTraining-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="n">train_batch_size</span>
</span><span id="PytorchTraining-176"><a href="#PytorchTraining-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validation_batch_size</span> <span class="o">=</span> <span class="n">validation_batch_size</span>
</span><span id="PytorchTraining-177"><a href="#PytorchTraining-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r_split</span> <span class="o">=</span> <span class="n">r_split</span>
</span><span id="PytorchTraining-178"><a href="#PytorchTraining-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span> <span class="o">=</span> <span class="n">network_transform</span>
</span><span id="PytorchTraining-179"><a href="#PytorchTraining-179"><span class="linenos">179</span></a>
</span><span id="PytorchTraining-180"><a href="#PytorchTraining-180"><span class="linenos">180</span></a>        <span class="k">assert</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;mps&#39;</span>
</span><span id="PytorchTraining-181"><a href="#PytorchTraining-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining-182"><a href="#PytorchTraining-182"><span class="linenos">182</span></a>
</span><span id="PytorchTraining-183"><a href="#PytorchTraining-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">train_patience</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-184"><a href="#PytorchTraining-184"><span class="linenos">184</span></a>            <span class="n">train_patience</span> <span class="o">=</span> <span class="n">n_epochs</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PytorchTraining-185"><a href="#PytorchTraining-185"><span class="linenos">185</span></a>
</span><span id="PytorchTraining-186"><a href="#PytorchTraining-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_patience</span> <span class="o">=</span> <span class="n">train_patience</span>
</span><span id="PytorchTraining-187"><a href="#PytorchTraining-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">=</span> <span class="n">verbose_rate</span>
</span><span id="PytorchTraining-188"><a href="#PytorchTraining-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">=</span> <span class="n">checkpoints_root</span>
</span><span id="PytorchTraining-189"><a href="#PytorchTraining-189"><span class="linenos">189</span></a>
</span><span id="PytorchTraining-190"><a href="#PytorchTraining-190"><span class="linenos">190</span></a>        <span class="c1"># Sanitize checkpoints root as a path</span>
</span><span id="PytorchTraining-191"><a href="#PytorchTraining-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="PytorchTraining-192"><a href="#PytorchTraining-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
</span><span id="PytorchTraining-193"><a href="#PytorchTraining-193"><span class="linenos">193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="PytorchTraining-194"><a href="#PytorchTraining-194"><span class="linenos">194</span></a>
</span><span id="PytorchTraining-195"><a href="#PytorchTraining-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">:</span>
</span><span id="PytorchTraining-196"><a href="#PytorchTraining-196"><span class="linenos">196</span></a>
</span><span id="PytorchTraining-197"><a href="#PytorchTraining-197"><span class="linenos">197</span></a>        <span class="n">pytorch_converter</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchConverter</span><span class="p">()</span>
</span><span id="PytorchTraining-198"><a href="#PytorchTraining-198"><span class="linenos">198</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="n">pytorch_converter</span><span class="o">.</span><span class="n">from_neural_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</span><span id="PytorchTraining-199"><a href="#PytorchTraining-199"><span class="linenos">199</span></a>
</span><span id="PytorchTraining-200"><a href="#PytorchTraining-200"><span class="linenos">200</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_training</span><span class="p">(</span><span class="n">py_net</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span><span id="PytorchTraining-201"><a href="#PytorchTraining-201"><span class="linenos">201</span></a>
</span><span id="PytorchTraining-202"><a href="#PytorchTraining-202"><span class="linenos">202</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">alt_rep_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="PytorchTraining-203"><a href="#PytorchTraining-203"><span class="linenos">203</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">alt_rep_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">py_net</span><span class="p">)</span>
</span><span id="PytorchTraining-204"><a href="#PytorchTraining-204"><span class="linenos">204</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">up_to_date</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PytorchTraining-205"><a href="#PytorchTraining-205"><span class="linenos">205</span></a>
</span><span id="PytorchTraining-206"><a href="#PytorchTraining-206"><span class="linenos">206</span></a>        <span class="k">return</span> <span class="n">network</span>
</span><span id="PytorchTraining-207"><a href="#PytorchTraining-207"><span class="linenos">207</span></a>
</span><span id="PytorchTraining-208"><a href="#PytorchTraining-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">pytorch_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">:</span>
</span><span id="PytorchTraining-209"><a href="#PytorchTraining-209"><span class="linenos">209</span></a>
</span><span id="PytorchTraining-210"><a href="#PytorchTraining-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PytorchTraining-211"><a href="#PytorchTraining-211"><span class="linenos">211</span></a><span class="sd">        Training procedure for the PyTorchNetwork.</span>
</span><span id="PytorchTraining-212"><a href="#PytorchTraining-212"><span class="linenos">212</span></a>
</span><span id="PytorchTraining-213"><a href="#PytorchTraining-213"><span class="linenos">213</span></a><span class="sd">        Parameters</span>
</span><span id="PytorchTraining-214"><a href="#PytorchTraining-214"><span class="linenos">214</span></a><span class="sd">        ----------</span>
</span><span id="PytorchTraining-215"><a href="#PytorchTraining-215"><span class="linenos">215</span></a><span class="sd">        net : PyTorchNetwork</span>
</span><span id="PytorchTraining-216"><a href="#PytorchTraining-216"><span class="linenos">216</span></a><span class="sd">            The PyTorchNetwork to train.</span>
</span><span id="PytorchTraining-217"><a href="#PytorchTraining-217"><span class="linenos">217</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="PytorchTraining-218"><a href="#PytorchTraining-218"><span class="linenos">218</span></a><span class="sd">            The dataset to use for the training of the PyTorchNetwork</span>
</span><span id="PytorchTraining-219"><a href="#PytorchTraining-219"><span class="linenos">219</span></a>
</span><span id="PytorchTraining-220"><a href="#PytorchTraining-220"><span class="linenos">220</span></a><span class="sd">        Returns</span>
</span><span id="PytorchTraining-221"><a href="#PytorchTraining-221"><span class="linenos">221</span></a><span class="sd">        ----------</span>
</span><span id="PytorchTraining-222"><a href="#PytorchTraining-222"><span class="linenos">222</span></a><span class="sd">        PyTorchNetwork</span>
</span><span id="PytorchTraining-223"><a href="#PytorchTraining-223"><span class="linenos">223</span></a><span class="sd">            The trained PyTorchNetwork.</span>
</span><span id="PytorchTraining-224"><a href="#PytorchTraining-224"><span class="linenos">224</span></a>
</span><span id="PytorchTraining-225"><a href="#PytorchTraining-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PytorchTraining-226"><a href="#PytorchTraining-226"><span class="linenos">226</span></a>
</span><span id="PytorchTraining-227"><a href="#PytorchTraining-227"><span class="linenos">227</span></a>        <span class="c1"># We set the model to the opportune device.</span>
</span><span id="PytorchTraining-228"><a href="#PytorchTraining-228"><span class="linenos">228</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-229"><a href="#PytorchTraining-229"><span class="linenos">229</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining-230"><a href="#PytorchTraining-230"><span class="linenos">230</span></a>
</span><span id="PytorchTraining-231"><a href="#PytorchTraining-231"><span class="linenos">231</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="PytorchTraining-232"><a href="#PytorchTraining-232"><span class="linenos">232</span></a>
</span><span id="PytorchTraining-233"><a href="#PytorchTraining-233"><span class="linenos">233</span></a>        <span class="c1"># We build the optimizer and the scheduler</span>
</span><span id="PytorchTraining-234"><a href="#PytorchTraining-234"><span class="linenos">234</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_con</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_params</span><span class="p">)</span>
</span><span id="PytorchTraining-235"><a href="#PytorchTraining-235"><span class="linenos">235</span></a>
</span><span id="PytorchTraining-236"><a href="#PytorchTraining-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-237"><a href="#PytorchTraining-237"><span class="linenos">237</span></a>            <span class="n">scheduler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sch_params</span><span class="p">)</span>
</span><span id="PytorchTraining-238"><a href="#PytorchTraining-238"><span class="linenos">238</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining-239"><a href="#PytorchTraining-239"><span class="linenos">239</span></a>            <span class="n">scheduler</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTraining-240"><a href="#PytorchTraining-240"><span class="linenos">240</span></a>
</span><span id="PytorchTraining-241"><a href="#PytorchTraining-241"><span class="linenos">241</span></a>        <span class="c1"># We split the dataset in training set and validation set.</span>
</span><span id="PytorchTraining-242"><a href="#PytorchTraining-242"><span class="linenos">242</span></a>        <span class="n">validation_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_percentage</span><span class="p">)</span>
</span><span id="PytorchTraining-243"><a href="#PytorchTraining-243"><span class="linenos">243</span></a>        <span class="n">training_len</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">-</span> <span class="n">validation_len</span>
</span><span id="PytorchTraining-244"><a href="#PytorchTraining-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_split</span><span class="p">:</span>
</span><span id="PytorchTraining-245"><a href="#PytorchTraining-245"><span class="linenos">245</span></a>            <span class="n">training_set</span><span class="p">,</span> <span class="n">validation_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">random_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">training_len</span><span class="p">,</span> <span class="n">validation_len</span><span class="p">))</span>
</span><span id="PytorchTraining-246"><a href="#PytorchTraining-246"><span class="linenos">246</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining-247"><a href="#PytorchTraining-247"><span class="linenos">247</span></a>            <span class="n">training_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_len</span><span class="p">))</span>
</span><span id="PytorchTraining-248"><a href="#PytorchTraining-248"><span class="linenos">248</span></a>            <span class="n">validation_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_len</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>
</span><span id="PytorchTraining-249"><a href="#PytorchTraining-249"><span class="linenos">249</span></a>
</span><span id="PytorchTraining-250"><a href="#PytorchTraining-250"><span class="linenos">250</span></a>        <span class="c1"># We instantiate the data loaders</span>
</span><span id="PytorchTraining-251"><a href="#PytorchTraining-251"><span class="linenos">251</span></a>        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">training_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span><span class="p">)</span>
</span><span id="PytorchTraining-252"><a href="#PytorchTraining-252"><span class="linenos">252</span></a>        <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">validation_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_batch_size</span><span class="p">)</span>
</span><span id="PytorchTraining-253"><a href="#PytorchTraining-253"><span class="linenos">253</span></a>
</span><span id="PytorchTraining-254"><a href="#PytorchTraining-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-255"><a href="#PytorchTraining-255"><span class="linenos">255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="PytorchTraining-256"><a href="#PytorchTraining-256"><span class="linenos">256</span></a>
</span><span id="PytorchTraining-257"><a href="#PytorchTraining-257"><span class="linenos">257</span></a>        <span class="c1"># If a checkpoint exist, we load the checkpoint of interest</span>
</span><span id="PytorchTraining-258"><a href="#PytorchTraining-258"><span class="linenos">258</span></a>        <span class="n">checkpoints_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="n">net</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="s1">&#39;.pth.tar&#39;</span>
</span><span id="PytorchTraining-259"><a href="#PytorchTraining-259"><span class="linenos">259</span></a>        <span class="n">best_model_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="n">net</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="s1">&#39;_best.pth.tar&#39;</span>
</span><span id="PytorchTraining-260"><a href="#PytorchTraining-260"><span class="linenos">260</span></a>
</span><span id="PytorchTraining-261"><a href="#PytorchTraining-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">):</span>
</span><span id="PytorchTraining-262"><a href="#PytorchTraining-262"><span class="linenos">262</span></a>
</span><span id="PytorchTraining-263"><a href="#PytorchTraining-263"><span class="linenos">263</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading Checkpoint: &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining-264"><a href="#PytorchTraining-264"><span class="linenos">264</span></a>            <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">)</span>
</span><span id="PytorchTraining-265"><a href="#PytorchTraining-265"><span class="linenos">265</span></a>            <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
</span><span id="PytorchTraining-266"><a href="#PytorchTraining-266"><span class="linenos">266</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;network_state_dict&#39;</span><span class="p">])</span>
</span><span id="PytorchTraining-267"><a href="#PytorchTraining-267"><span class="linenos">267</span></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">])</span>
</span><span id="PytorchTraining-268"><a href="#PytorchTraining-268"><span class="linenos">268</span></a>            <span class="n">best_loss_score</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;best_loss_score&#39;</span><span class="p">]</span>
</span><span id="PytorchTraining-269"><a href="#PytorchTraining-269"><span class="linenos">269</span></a>            <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epochs_without_decrease&#39;</span><span class="p">]</span>
</span><span id="PytorchTraining-270"><a href="#PytorchTraining-270"><span class="linenos">270</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded Checkpoint: &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining-271"><a href="#PytorchTraining-271"><span class="linenos">271</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">start_epoch</span><span class="si">}</span><span class="s2">, Best Loss Score: </span><span class="si">{</span><span class="n">best_loss_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining-272"><a href="#PytorchTraining-272"><span class="linenos">272</span></a>
</span><span id="PytorchTraining-273"><a href="#PytorchTraining-273"><span class="linenos">273</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining-274"><a href="#PytorchTraining-274"><span class="linenos">274</span></a>            <span class="c1"># Otherwise we initialize the values of interest</span>
</span><span id="PytorchTraining-275"><a href="#PytorchTraining-275"><span class="linenos">275</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Checkpoint was found at &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining-276"><a href="#PytorchTraining-276"><span class="linenos">276</span></a>            <span class="c1"># best_loss_score is set to a high number so that the first epoch will replace it</span>
</span><span id="PytorchTraining-277"><a href="#PytorchTraining-277"><span class="linenos">277</span></a>            <span class="n">best_loss_score</span> <span class="o">=</span> <span class="mi">999999</span>
</span><span id="PytorchTraining-278"><a href="#PytorchTraining-278"><span class="linenos">278</span></a>            <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining-279"><a href="#PytorchTraining-279"><span class="linenos">279</span></a>            <span class="n">start_epoch</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining-280"><a href="#PytorchTraining-280"><span class="linenos">280</span></a>
</span><span id="PytorchTraining-281"><a href="#PytorchTraining-281"><span class="linenos">281</span></a>        <span class="c1"># history_score is used to keep track of the evolution of training loss and validation loss</span>
</span><span id="PytorchTraining-282"><a href="#PytorchTraining-282"><span class="linenos">282</span></a>        <span class="n">history_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span> <span class="o">-</span> <span class="n">start_epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="PytorchTraining-283"><a href="#PytorchTraining-283"><span class="linenos">283</span></a>
</span><span id="PytorchTraining-284"><a href="#PytorchTraining-284"><span class="linenos">284</span></a>
</span><span id="PytorchTraining-285"><a href="#PytorchTraining-285"><span class="linenos">285</span></a>        <span class="c1"># We begin the real and proper training of the network. In the outer cycle we consider the epochs and for each</span>
</span><span id="PytorchTraining-286"><a href="#PytorchTraining-286"><span class="linenos">286</span></a>        <span class="c1"># epochs until termination we consider all the batches</span>
</span><span id="PytorchTraining-287"><a href="#PytorchTraining-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_epoch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span><span class="p">):</span>
</span><span id="PytorchTraining-288"><a href="#PytorchTraining-288"><span class="linenos">288</span></a>
</span><span id="PytorchTraining-289"><a href="#PytorchTraining-289"><span class="linenos">289</span></a>            <span class="k">if</span> <span class="n">epochs_without_decrease</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_patience</span><span class="p">:</span>
</span><span id="PytorchTraining-290"><a href="#PytorchTraining-290"><span class="linenos">290</span></a>                <span class="k">break</span>
</span><span id="PytorchTraining-291"><a href="#PytorchTraining-291"><span class="linenos">291</span></a>
</span><span id="PytorchTraining-292"><a href="#PytorchTraining-292"><span class="linenos">292</span></a>            <span class="c1"># We set all the values of the network to double.</span>
</span><span id="PytorchTraining-293"><a href="#PytorchTraining-293"><span class="linenos">293</span></a>            <span class="c1"># net.pytorch_network.double()</span>
</span><span id="PytorchTraining-294"><a href="#PytorchTraining-294"><span class="linenos">294</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-295"><a href="#PytorchTraining-295"><span class="linenos">295</span></a>            <span class="c1"># We set the network to train mode.</span>
</span><span id="PytorchTraining-296"><a href="#PytorchTraining-296"><span class="linenos">296</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="PytorchTraining-297"><a href="#PytorchTraining-297"><span class="linenos">297</span></a>            <span class="n">avg_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining-298"><a href="#PytorchTraining-298"><span class="linenos">298</span></a>
</span><span id="PytorchTraining-299"><a href="#PytorchTraining-299"><span class="linenos">299</span></a>            <span class="c1"># For each batch we compute one learning step</span>
</span><span id="PytorchTraining-300"><a href="#PytorchTraining-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
</span><span id="PytorchTraining-301"><a href="#PytorchTraining-301"><span class="linenos">301</span></a>
</span><span id="PytorchTraining-302"><a href="#PytorchTraining-302"><span class="linenos">302</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-303"><a href="#PytorchTraining-303"><span class="linenos">303</span></a>                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="PytorchTraining-304"><a href="#PytorchTraining-304"><span class="linenos">304</span></a>                    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-305"><a href="#PytorchTraining-305"><span class="linenos">305</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining-306"><a href="#PytorchTraining-306"><span class="linenos">306</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining-307"><a href="#PytorchTraining-307"><span class="linenos">307</span></a>                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="PytorchTraining-308"><a href="#PytorchTraining-308"><span class="linenos">308</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="PytorchTraining-309"><a href="#PytorchTraining-309"><span class="linenos">309</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining-310"><a href="#PytorchTraining-310"><span class="linenos">310</span></a>                <span class="n">avg_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="PytorchTraining-311"><a href="#PytorchTraining-311"><span class="linenos">311</span></a>                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="PytorchTraining-312"><a href="#PytorchTraining-312"><span class="linenos">312</span></a>
</span><span id="PytorchTraining-313"><a href="#PytorchTraining-313"><span class="linenos">313</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-314"><a href="#PytorchTraining-314"><span class="linenos">314</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</span><span id="PytorchTraining-315"><a href="#PytorchTraining-315"><span class="linenos">315</span></a>
</span><span id="PytorchTraining-316"><a href="#PytorchTraining-316"><span class="linenos">316</span></a>                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="PytorchTraining-317"><a href="#PytorchTraining-317"><span class="linenos">317</span></a>
</span><span id="PytorchTraining-318"><a href="#PytorchTraining-318"><span class="linenos">318</span></a>                <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PytorchTraining-319"><a href="#PytorchTraining-319"><span class="linenos">319</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Train Epoch: </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{:.1f}</span><span class="s1">%)]</span><span class="se">\t</span><span class="s1">Loss: </span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PytorchTraining-320"><a href="#PytorchTraining-320"><span class="linenos">320</span></a>                        <span class="n">epoch</span><span class="p">,</span> <span class="n">batch_idx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="p">),</span>
</span><span id="PytorchTraining-321"><a href="#PytorchTraining-321"><span class="linenos">321</span></a>                               <span class="mf">100.</span> <span class="o">*</span> <span class="n">batch_idx</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span><span class="p">),</span>
</span><span id="PytorchTraining-322"><a href="#PytorchTraining-322"><span class="linenos">322</span></a>                        <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span><span id="PytorchTraining-323"><a href="#PytorchTraining-323"><span class="linenos">323</span></a>
</span><span id="PytorchTraining-324"><a href="#PytorchTraining-324"><span class="linenos">324</span></a>            <span class="c1"># avg_loss = avg_loss / float(math.floor(len(training_set) / self.train_batch_size))</span>
</span><span id="PytorchTraining-325"><a href="#PytorchTraining-325"><span class="linenos">325</span></a>            <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">avg_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="PytorchTraining-326"><a href="#PytorchTraining-326"><span class="linenos">326</span></a>            <span class="n">history_score</span><span class="p">[</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_loss</span>
</span><span id="PytorchTraining-327"><a href="#PytorchTraining-327"><span class="linenos">327</span></a>
</span><span id="PytorchTraining-328"><a href="#PytorchTraining-328"><span class="linenos">328</span></a>            <span class="c1"># EPOCH TEST</span>
</span><span id="PytorchTraining-329"><a href="#PytorchTraining-329"><span class="linenos">329</span></a>
</span><span id="PytorchTraining-330"><a href="#PytorchTraining-330"><span class="linenos">330</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="PytorchTraining-331"><a href="#PytorchTraining-331"><span class="linenos">331</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-332"><a href="#PytorchTraining-332"><span class="linenos">332</span></a>            <span class="n">validation_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining-333"><a href="#PytorchTraining-333"><span class="linenos">333</span></a>            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="PytorchTraining-334"><a href="#PytorchTraining-334"><span class="linenos">334</span></a>
</span><span id="PytorchTraining-335"><a href="#PytorchTraining-335"><span class="linenos">335</span></a>                <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">validation_loader</span><span class="p">):</span>
</span><span id="PytorchTraining-336"><a href="#PytorchTraining-336"><span class="linenos">336</span></a>
</span><span id="PytorchTraining-337"><a href="#PytorchTraining-337"><span class="linenos">337</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-338"><a href="#PytorchTraining-338"><span class="linenos">338</span></a>                    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="PytorchTraining-339"><a href="#PytorchTraining-339"><span class="linenos">339</span></a>                        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining-340"><a href="#PytorchTraining-340"><span class="linenos">340</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining-341"><a href="#PytorchTraining-341"><span class="linenos">341</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining-342"><a href="#PytorchTraining-342"><span class="linenos">342</span></a>                    <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="PytorchTraining-343"><a href="#PytorchTraining-343"><span class="linenos">343</span></a>                    <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision_metric</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining-344"><a href="#PytorchTraining-344"><span class="linenos">344</span></a>                    <span class="n">validation_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="PytorchTraining-345"><a href="#PytorchTraining-345"><span class="linenos">345</span></a>
</span><span id="PytorchTraining-346"><a href="#PytorchTraining-346"><span class="linenos">346</span></a>            <span class="c1"># validation_loss = validation_loss / float(math.floor(len(validation_set) / self.validation_batch_size))</span>
</span><span id="PytorchTraining-347"><a href="#PytorchTraining-347"><span class="linenos">347</span></a>            <span class="n">validation_loss</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="PytorchTraining-348"><a href="#PytorchTraining-348"><span class="linenos">348</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Validation Set Metric Value: </span><span class="si">{:.4f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">validation_loss</span><span class="p">))</span>
</span><span id="PytorchTraining-349"><a href="#PytorchTraining-349"><span class="linenos">349</span></a>
</span><span id="PytorchTraining-350"><a href="#PytorchTraining-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">validation_loss</span> <span class="o">&lt;</span> <span class="n">best_loss_score</span><span class="p">:</span>
</span><span id="PytorchTraining-351"><a href="#PytorchTraining-351"><span class="linenos">351</span></a>                <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining-352"><a href="#PytorchTraining-352"><span class="linenos">352</span></a>                <span class="n">best_loss_score</span> <span class="o">=</span> <span class="n">validation_loss</span>
</span><span id="PytorchTraining-353"><a href="#PytorchTraining-353"><span class="linenos">353</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining-354"><a href="#PytorchTraining-354"><span class="linenos">354</span></a>                <span class="n">epochs_without_decrease</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PytorchTraining-355"><a href="#PytorchTraining-355"><span class="linenos">355</span></a>
</span><span id="PytorchTraining-356"><a href="#PytorchTraining-356"><span class="linenos">356</span></a>            <span class="c1"># We need to distinguish among different scheduler because not all the pytorch scheduler present the same</span>
</span><span id="PytorchTraining-357"><a href="#PytorchTraining-357"><span class="linenos">357</span></a>            <span class="c1"># interface.</span>
</span><span id="PytorchTraining-358"><a href="#PytorchTraining-358"><span class="linenos">358</span></a>            <span class="k">if</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-359"><a href="#PytorchTraining-359"><span class="linenos">359</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scheduler</span><span class="p">,</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">):</span>
</span><span id="PytorchTraining-360"><a href="#PytorchTraining-360"><span class="linenos">360</span></a>                    <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">validation_loss</span><span class="p">)</span>
</span><span id="PytorchTraining-361"><a href="#PytorchTraining-361"><span class="linenos">361</span></a>                <span class="k">elif</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining-362"><a href="#PytorchTraining-362"><span class="linenos">362</span></a>                    <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="PytorchTraining-363"><a href="#PytorchTraining-363"><span class="linenos">363</span></a>
</span><span id="PytorchTraining-364"><a href="#PytorchTraining-364"><span class="linenos">364</span></a>            <span class="c1"># CHECKPOINT</span>
</span><span id="PytorchTraining-365"><a href="#PytorchTraining-365"><span class="linenos">365</span></a>
</span><span id="PytorchTraining-366"><a href="#PytorchTraining-366"><span class="linenos">366</span></a>            <span class="n">history_score</span><span class="p">[</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_loss</span>
</span><span id="PytorchTraining-367"><a href="#PytorchTraining-367"><span class="linenos">367</span></a>            <span class="n">is_best</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">&lt;</span> <span class="n">best_loss_score</span>
</span><span id="PytorchTraining-368"><a href="#PytorchTraining-368"><span class="linenos">368</span></a>
</span><span id="PytorchTraining-369"><a href="#PytorchTraining-369"><span class="linenos">369</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PytorchTraining-370"><a href="#PytorchTraining-370"><span class="linenos">370</span></a>                <span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PytorchTraining-371"><a href="#PytorchTraining-371"><span class="linenos">371</span></a>                <span class="s1">&#39;network_state_dict&#39;</span><span class="p">:</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span><span id="PytorchTraining-372"><a href="#PytorchTraining-372"><span class="linenos">372</span></a>                <span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">:</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span><span id="PytorchTraining-373"><a href="#PytorchTraining-373"><span class="linenos">373</span></a>                <span class="s1">&#39;best_loss_score&#39;</span><span class="p">:</span> <span class="n">best_loss_score</span><span class="p">,</span>
</span><span id="PytorchTraining-374"><a href="#PytorchTraining-374"><span class="linenos">374</span></a>                <span class="s1">&#39;epochs_without_decrease&#39;</span><span class="p">:</span> <span class="n">epochs_without_decrease</span>
</span><span id="PytorchTraining-375"><a href="#PytorchTraining-375"><span class="linenos">375</span></a>            <span class="p">}</span>
</span><span id="PytorchTraining-376"><a href="#PytorchTraining-376"><span class="linenos">376</span></a>
</span><span id="PytorchTraining-377"><a href="#PytorchTraining-377"><span class="linenos">377</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">checkpoints_path</span><span class="p">)</span>
</span><span id="PytorchTraining-378"><a href="#PytorchTraining-378"><span class="linenos">378</span></a>            <span class="k">if</span> <span class="n">is_best</span><span class="p">:</span>
</span><span id="PytorchTraining-379"><a href="#PytorchTraining-379"><span class="linenos">379</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">,</span> <span class="n">best_model_path</span><span class="p">)</span>
</span><span id="PytorchTraining-380"><a href="#PytorchTraining-380"><span class="linenos">380</span></a>
</span><span id="PytorchTraining-381"><a href="#PytorchTraining-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">):</span>
</span><span id="PytorchTraining-382"><a href="#PytorchTraining-382"><span class="linenos">382</span></a>            <span class="n">best_checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>
</span><span id="PytorchTraining-383"><a href="#PytorchTraining-383"><span class="linenos">383</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">best_checkpoint</span><span class="p">[</span><span class="s1">&#39;network_state_dict&#39;</span><span class="p">])</span>
</span><span id="PytorchTraining-384"><a href="#PytorchTraining-384"><span class="linenos">384</span></a>
</span><span id="PytorchTraining-385"><a href="#PytorchTraining-385"><span class="linenos">385</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Loss Score: </span><span class="si">{</span><span class="n">best_loss_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining-386"><a href="#PytorchTraining-386"><span class="linenos">386</span></a>
</span><span id="PytorchTraining-387"><a href="#PytorchTraining-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="n">net</span>
</span></pre></div>


            <div class="docstring"><p>Class used to represent the training strategy based on the Pytorch learning framework.
It supports different optimization algorithm, schedulers, loss function and others based on
the attributes provided at instantiation time.</p>

<h2 id="attributes">Attributes</h2>

<p>optimizer_con : type
    Reference to the class constructor for the Optimizer of choice for the training strategy.</p>

<p>opt_params : Dict
    Dictionary of the parameters to pass to the constructor of the optimizer excluding the first which is always
    assumed to be the parameters to optimize</p>

<p>loss_function : Callable
    Loss function for the training strategy. We assume it to take as parameters two pytorch Tensor
    corresponding to the output of the network and the target. Other parameter should be given as attribute of
    the callable object.</p>

<p>n_epochs : int
    Number of epochs for the training procedure.</p>

<p>validation_percentage : float
    Percentage of the dataset to use as the validation set</p>

<p>train_batch_size : int
    Dimension for the train batch size for the training procedure</p>

<p>validation_batch_size : int
    Dimension for the validation batch size for the training procedure</p>

<p>scheduler_con : type, Optional
    Reference to the class constructor for the Scheduler for the learning rate of choice for the training strategy
    (default: None)</p>

<p>sch_params : Dict, Optional
    Dictionary of the parameters to pass to the constructor of the scheduler excluding the first which is always
    assumed to be the optimizer whose learning rate must be updated. (default: None)</p>

<p>precision_metric : Callable, Optional
    Function for measuring the precision of the neural network. It is used to choose the best model and to control
    the Plateau Scheduler and the early stopping. We assume it to take as parameters two pytorch Tensor
    corresponding to the output of the network and the target.It should produce a float value and such value should
    decrease for increasing correctness of the network (as the traditional loss value).
    Optional supplementary parameters should be given as attributes of the object. (default: None)</p>

<p>network_transform : Callable, Optional
    We provide the possibility to define a function which will be applied to the network after
    the computation of backward and before the optimizer step. In practice we use it for the manipulation
    needed to the pruning oriented training. It should take a pytorch module (i.e., the neural network) as
    input and optional supplementary parameters () should be given as attributes of the object. (default: None)</p>

<p>cuda : bool, Optional
    Whether to use the cuda library for the procedure (default: False).</p>

<p>train_patience : int, Optional
    The number of epochs in which the loss may not decrease before the
    training procedure is interrupted with early stopping (default: None).</p>

<p>checkpoints_root : str, Optional
    Where to store the checkpoints of the training strategy. (default: '')</p>

<p>verbose_rate : int, Optional
    After how many batch the strategy prints information about how the training is going.</p>
</div>


                            <div id="PytorchTraining.__init__" class="classattr">
                                        <input id="PytorchTraining.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PytorchTraining</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">optimizer_con</span><span class="p">:</span> <span class="nb">type</span>,</span><span class="param">	<span class="n">opt_params</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">loss_function</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">validation_percentage</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">train_batch_size</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">validation_batch_size</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">r_split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">scheduler_con</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sch_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">precision_metric</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">network_transform</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span>,</span><span class="param">	<span class="n">train_patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">checkpoints_root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">verbose_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="PytorchTraining.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTraining.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTraining.__init__-155"><a href="#PytorchTraining.__init__-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimizer_con</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">opt_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">loss_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PytorchTraining.__init__-156"><a href="#PytorchTraining.__init__-156"><span class="linenos">156</span></a>                 <span class="n">validation_percentage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">train_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">validation_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r_split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PytorchTraining.__init__-157"><a href="#PytorchTraining.__init__-157"><span class="linenos">157</span></a>                 <span class="n">scheduler_con</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sch_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">precision_metric</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PytorchTraining.__init__-158"><a href="#PytorchTraining.__init__-158"><span class="linenos">158</span></a>                 <span class="n">network_transform</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">train_patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PytorchTraining.__init__-159"><a href="#PytorchTraining.__init__-159"><span class="linenos">159</span></a>                 <span class="n">checkpoints_root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="PytorchTraining.__init__-160"><a href="#PytorchTraining.__init__-160"><span class="linenos">160</span></a>
</span><span id="PytorchTraining.__init__-161"><a href="#PytorchTraining.__init__-161"><span class="linenos">161</span></a>        <span class="n">TrainingStrategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="PytorchTraining.__init__-162"><a href="#PytorchTraining.__init__-162"><span class="linenos">162</span></a>
</span><span id="PytorchTraining.__init__-163"><a href="#PytorchTraining.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_con</span> <span class="o">=</span> <span class="n">optimizer_con</span>
</span><span id="PytorchTraining.__init__-164"><a href="#PytorchTraining.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">opt_params</span> <span class="o">=</span> <span class="n">opt_params</span>
</span><span id="PytorchTraining.__init__-165"><a href="#PytorchTraining.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span> <span class="o">=</span> <span class="n">scheduler_con</span>
</span><span id="PytorchTraining.__init__-166"><a href="#PytorchTraining.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sch_params</span> <span class="o">=</span> <span class="n">sch_params</span>
</span><span id="PytorchTraining.__init__-167"><a href="#PytorchTraining.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span> <span class="o">=</span> <span class="n">loss_function</span>
</span><span id="PytorchTraining.__init__-168"><a href="#PytorchTraining.__init__-168"><span class="linenos">168</span></a>
</span><span id="PytorchTraining.__init__-169"><a href="#PytorchTraining.__init__-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">precision_metric</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.__init__-170"><a href="#PytorchTraining.__init__-170"><span class="linenos">170</span></a>            <span class="n">precision_metric</span> <span class="o">=</span> <span class="n">loss_function</span>
</span><span id="PytorchTraining.__init__-171"><a href="#PytorchTraining.__init__-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision_metric</span> <span class="o">=</span> <span class="n">precision_metric</span>
</span><span id="PytorchTraining.__init__-172"><a href="#PytorchTraining.__init__-172"><span class="linenos">172</span></a>
</span><span id="PytorchTraining.__init__-173"><a href="#PytorchTraining.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span> <span class="o">=</span> <span class="n">n_epochs</span>
</span><span id="PytorchTraining.__init__-174"><a href="#PytorchTraining.__init__-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validation_percentage</span> <span class="o">=</span> <span class="n">validation_percentage</span>
</span><span id="PytorchTraining.__init__-175"><a href="#PytorchTraining.__init__-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="n">train_batch_size</span>
</span><span id="PytorchTraining.__init__-176"><a href="#PytorchTraining.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validation_batch_size</span> <span class="o">=</span> <span class="n">validation_batch_size</span>
</span><span id="PytorchTraining.__init__-177"><a href="#PytorchTraining.__init__-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r_split</span> <span class="o">=</span> <span class="n">r_split</span>
</span><span id="PytorchTraining.__init__-178"><a href="#PytorchTraining.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span> <span class="o">=</span> <span class="n">network_transform</span>
</span><span id="PytorchTraining.__init__-179"><a href="#PytorchTraining.__init__-179"><span class="linenos">179</span></a>
</span><span id="PytorchTraining.__init__-180"><a href="#PytorchTraining.__init__-180"><span class="linenos">180</span></a>        <span class="k">assert</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;mps&#39;</span>
</span><span id="PytorchTraining.__init__-181"><a href="#PytorchTraining.__init__-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining.__init__-182"><a href="#PytorchTraining.__init__-182"><span class="linenos">182</span></a>
</span><span id="PytorchTraining.__init__-183"><a href="#PytorchTraining.__init__-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">train_patience</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.__init__-184"><a href="#PytorchTraining.__init__-184"><span class="linenos">184</span></a>            <span class="n">train_patience</span> <span class="o">=</span> <span class="n">n_epochs</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PytorchTraining.__init__-185"><a href="#PytorchTraining.__init__-185"><span class="linenos">185</span></a>
</span><span id="PytorchTraining.__init__-186"><a href="#PytorchTraining.__init__-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train_patience</span> <span class="o">=</span> <span class="n">train_patience</span>
</span><span id="PytorchTraining.__init__-187"><a href="#PytorchTraining.__init__-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">=</span> <span class="n">verbose_rate</span>
</span><span id="PytorchTraining.__init__-188"><a href="#PytorchTraining.__init__-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">=</span> <span class="n">checkpoints_root</span>
</span><span id="PytorchTraining.__init__-189"><a href="#PytorchTraining.__init__-189"><span class="linenos">189</span></a>
</span><span id="PytorchTraining.__init__-190"><a href="#PytorchTraining.__init__-190"><span class="linenos">190</span></a>        <span class="c1"># Sanitize checkpoints root as a path</span>
</span><span id="PytorchTraining.__init__-191"><a href="#PytorchTraining.__init__-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="PytorchTraining.__init__-192"><a href="#PytorchTraining.__init__-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
</span><span id="PytorchTraining.__init__-193"><a href="#PytorchTraining.__init__-193"><span class="linenos">193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span></pre></div>


    

                            </div>
                            <div id="PytorchTraining.optimizer_con" class="classattr">
                                <div class="attr variable">
            <span class="name">optimizer_con</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.optimizer_con"></a>
    
    

                            </div>
                            <div id="PytorchTraining.opt_params" class="classattr">
                                <div class="attr variable">
            <span class="name">opt_params</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.opt_params"></a>
    
    

                            </div>
                            <div id="PytorchTraining.scheduler_con" class="classattr">
                                <div class="attr variable">
            <span class="name">scheduler_con</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.scheduler_con"></a>
    
    

                            </div>
                            <div id="PytorchTraining.sch_params" class="classattr">
                                <div class="attr variable">
            <span class="name">sch_params</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.sch_params"></a>
    
    

                            </div>
                            <div id="PytorchTraining.loss_function" class="classattr">
                                <div class="attr variable">
            <span class="name">loss_function</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.loss_function"></a>
    
    

                            </div>
                            <div id="PytorchTraining.precision_metric" class="classattr">
                                <div class="attr variable">
            <span class="name">precision_metric</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.precision_metric"></a>
    
    

                            </div>
                            <div id="PytorchTraining.n_epochs" class="classattr">
                                <div class="attr variable">
            <span class="name">n_epochs</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.n_epochs"></a>
    
    

                            </div>
                            <div id="PytorchTraining.validation_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">validation_percentage</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.validation_percentage"></a>
    
    

                            </div>
                            <div id="PytorchTraining.train_batch_size" class="classattr">
                                <div class="attr variable">
            <span class="name">train_batch_size</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.train_batch_size"></a>
    
    

                            </div>
                            <div id="PytorchTraining.validation_batch_size" class="classattr">
                                <div class="attr variable">
            <span class="name">validation_batch_size</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.validation_batch_size"></a>
    
    

                            </div>
                            <div id="PytorchTraining.r_split" class="classattr">
                                <div class="attr variable">
            <span class="name">r_split</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.r_split"></a>
    
    

                            </div>
                            <div id="PytorchTraining.network_transform" class="classattr">
                                <div class="attr variable">
            <span class="name">network_transform</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.network_transform"></a>
    
    

                            </div>
                            <div id="PytorchTraining.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.device"></a>
    
    

                            </div>
                            <div id="PytorchTraining.train_patience" class="classattr">
                                <div class="attr variable">
            <span class="name">train_patience</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.train_patience"></a>
    
    

                            </div>
                            <div id="PytorchTraining.verbose_rate" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose_rate</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.verbose_rate"></a>
    
    

                            </div>
                            <div id="PytorchTraining.checkpoints_root" class="classattr">
                                <div class="attr variable">
            <span class="name">checkpoints_root</span>

        
    </div>
    <a class="headerlink" href="#PytorchTraining.checkpoints_root"></a>
    
    

                            </div>
                            <div id="PytorchTraining.train" class="classattr">
                                        <input id="PytorchTraining.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">network</span><span class="p">:</span> <span class="n"><a href="../networks.html#NeuralNetwork">pynever.networks.NeuralNetwork</a></span>,</span><span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="n"><a href="../datasets.html#Dataset">pynever.datasets.Dataset</a></span></span><span class="return-annotation">) -> <span class="n"><a href="../networks.html#NeuralNetwork">pynever.networks.NeuralNetwork</a></span>:</span></span>

                <label class="view-source-button" for="PytorchTraining.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTraining.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTraining.train-195"><a href="#PytorchTraining.train-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">:</span>
</span><span id="PytorchTraining.train-196"><a href="#PytorchTraining.train-196"><span class="linenos">196</span></a>
</span><span id="PytorchTraining.train-197"><a href="#PytorchTraining.train-197"><span class="linenos">197</span></a>        <span class="n">pytorch_converter</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchConverter</span><span class="p">()</span>
</span><span id="PytorchTraining.train-198"><a href="#PytorchTraining.train-198"><span class="linenos">198</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="n">pytorch_converter</span><span class="o">.</span><span class="n">from_neural_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</span><span id="PytorchTraining.train-199"><a href="#PytorchTraining.train-199"><span class="linenos">199</span></a>
</span><span id="PytorchTraining.train-200"><a href="#PytorchTraining.train-200"><span class="linenos">200</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_training</span><span class="p">(</span><span class="n">py_net</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span><span id="PytorchTraining.train-201"><a href="#PytorchTraining.train-201"><span class="linenos">201</span></a>
</span><span id="PytorchTraining.train-202"><a href="#PytorchTraining.train-202"><span class="linenos">202</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">alt_rep_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="PytorchTraining.train-203"><a href="#PytorchTraining.train-203"><span class="linenos">203</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">alt_rep_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">py_net</span><span class="p">)</span>
</span><span id="PytorchTraining.train-204"><a href="#PytorchTraining.train-204"><span class="linenos">204</span></a>        <span class="n">network</span><span class="o">.</span><span class="n">up_to_date</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PytorchTraining.train-205"><a href="#PytorchTraining.train-205"><span class="linenos">205</span></a>
</span><span id="PytorchTraining.train-206"><a href="#PytorchTraining.train-206"><span class="linenos">206</span></a>        <span class="k">return</span> <span class="n">network</span>
</span></pre></div>


            <div class="docstring"><p>Train the neural network of interest using a testing strategy determined in the concrete children.</p>

<h2 id="parameters">Parameters</h2>

<p>network : NeuralNetwork
    The neural network to train.
dataset : Dataset
    The dataset to use to train the neural network.</p>

<h2 id="returns">Returns</h2>

<p>NeuralNetwork
    The Neural Network resulting from the training of the original network using the training strategy and the
    dataset.</p>
</div>


                            </div>
                            <div id="PytorchTraining.pytorch_training" class="classattr">
                                        <input id="PytorchTraining.pytorch_training-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pytorch_training</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">net</span><span class="p">:</span> <span class="n"><a href="conversion.html#PyTorchNetwork">pynever.strategies.conversion.PyTorchNetwork</a></span>,</span><span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="n"><a href="../datasets.html#Dataset">pynever.datasets.Dataset</a></span></span><span class="return-annotation">) -> <span class="n"><a href="conversion.html#PyTorchNetwork">pynever.strategies.conversion.PyTorchNetwork</a></span>:</span></span>

                <label class="view-source-button" for="PytorchTraining.pytorch_training-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTraining.pytorch_training"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTraining.pytorch_training-208"><a href="#PytorchTraining.pytorch_training-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">pytorch_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-209"><a href="#PytorchTraining.pytorch_training-209"><span class="linenos">209</span></a>
</span><span id="PytorchTraining.pytorch_training-210"><a href="#PytorchTraining.pytorch_training-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PytorchTraining.pytorch_training-211"><a href="#PytorchTraining.pytorch_training-211"><span class="linenos">211</span></a><span class="sd">        Training procedure for the PyTorchNetwork.</span>
</span><span id="PytorchTraining.pytorch_training-212"><a href="#PytorchTraining.pytorch_training-212"><span class="linenos">212</span></a>
</span><span id="PytorchTraining.pytorch_training-213"><a href="#PytorchTraining.pytorch_training-213"><span class="linenos">213</span></a><span class="sd">        Parameters</span>
</span><span id="PytorchTraining.pytorch_training-214"><a href="#PytorchTraining.pytorch_training-214"><span class="linenos">214</span></a><span class="sd">        ----------</span>
</span><span id="PytorchTraining.pytorch_training-215"><a href="#PytorchTraining.pytorch_training-215"><span class="linenos">215</span></a><span class="sd">        net : PyTorchNetwork</span>
</span><span id="PytorchTraining.pytorch_training-216"><a href="#PytorchTraining.pytorch_training-216"><span class="linenos">216</span></a><span class="sd">            The PyTorchNetwork to train.</span>
</span><span id="PytorchTraining.pytorch_training-217"><a href="#PytorchTraining.pytorch_training-217"><span class="linenos">217</span></a><span class="sd">        dataset : Dataset</span>
</span><span id="PytorchTraining.pytorch_training-218"><a href="#PytorchTraining.pytorch_training-218"><span class="linenos">218</span></a><span class="sd">            The dataset to use for the training of the PyTorchNetwork</span>
</span><span id="PytorchTraining.pytorch_training-219"><a href="#PytorchTraining.pytorch_training-219"><span class="linenos">219</span></a>
</span><span id="PytorchTraining.pytorch_training-220"><a href="#PytorchTraining.pytorch_training-220"><span class="linenos">220</span></a><span class="sd">        Returns</span>
</span><span id="PytorchTraining.pytorch_training-221"><a href="#PytorchTraining.pytorch_training-221"><span class="linenos">221</span></a><span class="sd">        ----------</span>
</span><span id="PytorchTraining.pytorch_training-222"><a href="#PytorchTraining.pytorch_training-222"><span class="linenos">222</span></a><span class="sd">        PyTorchNetwork</span>
</span><span id="PytorchTraining.pytorch_training-223"><a href="#PytorchTraining.pytorch_training-223"><span class="linenos">223</span></a><span class="sd">            The trained PyTorchNetwork.</span>
</span><span id="PytorchTraining.pytorch_training-224"><a href="#PytorchTraining.pytorch_training-224"><span class="linenos">224</span></a>
</span><span id="PytorchTraining.pytorch_training-225"><a href="#PytorchTraining.pytorch_training-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PytorchTraining.pytorch_training-226"><a href="#PytorchTraining.pytorch_training-226"><span class="linenos">226</span></a>
</span><span id="PytorchTraining.pytorch_training-227"><a href="#PytorchTraining.pytorch_training-227"><span class="linenos">227</span></a>        <span class="c1"># We set the model to the opportune device.</span>
</span><span id="PytorchTraining.pytorch_training-228"><a href="#PytorchTraining.pytorch_training-228"><span class="linenos">228</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-229"><a href="#PytorchTraining.pytorch_training-229"><span class="linenos">229</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-230"><a href="#PytorchTraining.pytorch_training-230"><span class="linenos">230</span></a>
</span><span id="PytorchTraining.pytorch_training-231"><a href="#PytorchTraining.pytorch_training-231"><span class="linenos">231</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-232"><a href="#PytorchTraining.pytorch_training-232"><span class="linenos">232</span></a>
</span><span id="PytorchTraining.pytorch_training-233"><a href="#PytorchTraining.pytorch_training-233"><span class="linenos">233</span></a>        <span class="c1"># We build the optimizer and the scheduler</span>
</span><span id="PytorchTraining.pytorch_training-234"><a href="#PytorchTraining.pytorch_training-234"><span class="linenos">234</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_con</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_params</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-235"><a href="#PytorchTraining.pytorch_training-235"><span class="linenos">235</span></a>
</span><span id="PytorchTraining.pytorch_training-236"><a href="#PytorchTraining.pytorch_training-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-237"><a href="#PytorchTraining.pytorch_training-237"><span class="linenos">237</span></a>            <span class="n">scheduler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_con</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sch_params</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-238"><a href="#PytorchTraining.pytorch_training-238"><span class="linenos">238</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-239"><a href="#PytorchTraining.pytorch_training-239"><span class="linenos">239</span></a>            <span class="n">scheduler</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTraining.pytorch_training-240"><a href="#PytorchTraining.pytorch_training-240"><span class="linenos">240</span></a>
</span><span id="PytorchTraining.pytorch_training-241"><a href="#PytorchTraining.pytorch_training-241"><span class="linenos">241</span></a>        <span class="c1"># We split the dataset in training set and validation set.</span>
</span><span id="PytorchTraining.pytorch_training-242"><a href="#PytorchTraining.pytorch_training-242"><span class="linenos">242</span></a>        <span class="n">validation_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_percentage</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-243"><a href="#PytorchTraining.pytorch_training-243"><span class="linenos">243</span></a>        <span class="n">training_len</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">-</span> <span class="n">validation_len</span>
</span><span id="PytorchTraining.pytorch_training-244"><a href="#PytorchTraining.pytorch_training-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_split</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-245"><a href="#PytorchTraining.pytorch_training-245"><span class="linenos">245</span></a>            <span class="n">training_set</span><span class="p">,</span> <span class="n">validation_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">random_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">training_len</span><span class="p">,</span> <span class="n">validation_len</span><span class="p">))</span>
</span><span id="PytorchTraining.pytorch_training-246"><a href="#PytorchTraining.pytorch_training-246"><span class="linenos">246</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-247"><a href="#PytorchTraining.pytorch_training-247"><span class="linenos">247</span></a>            <span class="n">training_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_len</span><span class="p">))</span>
</span><span id="PytorchTraining.pytorch_training-248"><a href="#PytorchTraining.pytorch_training-248"><span class="linenos">248</span></a>            <span class="n">validation_set</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">training_len</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span>
</span><span id="PytorchTraining.pytorch_training-249"><a href="#PytorchTraining.pytorch_training-249"><span class="linenos">249</span></a>
</span><span id="PytorchTraining.pytorch_training-250"><a href="#PytorchTraining.pytorch_training-250"><span class="linenos">250</span></a>        <span class="c1"># We instantiate the data loaders</span>
</span><span id="PytorchTraining.pytorch_training-251"><a href="#PytorchTraining.pytorch_training-251"><span class="linenos">251</span></a>        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">training_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-252"><a href="#PytorchTraining.pytorch_training-252"><span class="linenos">252</span></a>        <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">validation_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_batch_size</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-253"><a href="#PytorchTraining.pytorch_training-253"><span class="linenos">253</span></a>
</span><span id="PytorchTraining.pytorch_training-254"><a href="#PytorchTraining.pytorch_training-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-255"><a href="#PytorchTraining.pytorch_training-255"><span class="linenos">255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-256"><a href="#PytorchTraining.pytorch_training-256"><span class="linenos">256</span></a>
</span><span id="PytorchTraining.pytorch_training-257"><a href="#PytorchTraining.pytorch_training-257"><span class="linenos">257</span></a>        <span class="c1"># If a checkpoint exist, we load the checkpoint of interest</span>
</span><span id="PytorchTraining.pytorch_training-258"><a href="#PytorchTraining.pytorch_training-258"><span class="linenos">258</span></a>        <span class="n">checkpoints_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="n">net</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="s1">&#39;.pth.tar&#39;</span>
</span><span id="PytorchTraining.pytorch_training-259"><a href="#PytorchTraining.pytorch_training-259"><span class="linenos">259</span></a>        <span class="n">best_model_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_root</span> <span class="o">+</span> <span class="n">net</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="s1">&#39;_best.pth.tar&#39;</span>
</span><span id="PytorchTraining.pytorch_training-260"><a href="#PytorchTraining.pytorch_training-260"><span class="linenos">260</span></a>
</span><span id="PytorchTraining.pytorch_training-261"><a href="#PytorchTraining.pytorch_training-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">):</span>
</span><span id="PytorchTraining.pytorch_training-262"><a href="#PytorchTraining.pytorch_training-262"><span class="linenos">262</span></a>
</span><span id="PytorchTraining.pytorch_training-263"><a href="#PytorchTraining.pytorch_training-263"><span class="linenos">263</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading Checkpoint: &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-264"><a href="#PytorchTraining.pytorch_training-264"><span class="linenos">264</span></a>            <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-265"><a href="#PytorchTraining.pytorch_training-265"><span class="linenos">265</span></a>            <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
</span><span id="PytorchTraining.pytorch_training-266"><a href="#PytorchTraining.pytorch_training-266"><span class="linenos">266</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;network_state_dict&#39;</span><span class="p">])</span>
</span><span id="PytorchTraining.pytorch_training-267"><a href="#PytorchTraining.pytorch_training-267"><span class="linenos">267</span></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">])</span>
</span><span id="PytorchTraining.pytorch_training-268"><a href="#PytorchTraining.pytorch_training-268"><span class="linenos">268</span></a>            <span class="n">best_loss_score</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;best_loss_score&#39;</span><span class="p">]</span>
</span><span id="PytorchTraining.pytorch_training-269"><a href="#PytorchTraining.pytorch_training-269"><span class="linenos">269</span></a>            <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epochs_without_decrease&#39;</span><span class="p">]</span>
</span><span id="PytorchTraining.pytorch_training-270"><a href="#PytorchTraining.pytorch_training-270"><span class="linenos">270</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded Checkpoint: &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-271"><a href="#PytorchTraining.pytorch_training-271"><span class="linenos">271</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">start_epoch</span><span class="si">}</span><span class="s2">, Best Loss Score: </span><span class="si">{</span><span class="n">best_loss_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-272"><a href="#PytorchTraining.pytorch_training-272"><span class="linenos">272</span></a>
</span><span id="PytorchTraining.pytorch_training-273"><a href="#PytorchTraining.pytorch_training-273"><span class="linenos">273</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-274"><a href="#PytorchTraining.pytorch_training-274"><span class="linenos">274</span></a>            <span class="c1"># Otherwise we initialize the values of interest</span>
</span><span id="PytorchTraining.pytorch_training-275"><a href="#PytorchTraining.pytorch_training-275"><span class="linenos">275</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Checkpoint was found at &#39;</span><span class="si">{</span><span class="n">checkpoints_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-276"><a href="#PytorchTraining.pytorch_training-276"><span class="linenos">276</span></a>            <span class="c1"># best_loss_score is set to a high number so that the first epoch will replace it</span>
</span><span id="PytorchTraining.pytorch_training-277"><a href="#PytorchTraining.pytorch_training-277"><span class="linenos">277</span></a>            <span class="n">best_loss_score</span> <span class="o">=</span> <span class="mi">999999</span>
</span><span id="PytorchTraining.pytorch_training-278"><a href="#PytorchTraining.pytorch_training-278"><span class="linenos">278</span></a>            <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining.pytorch_training-279"><a href="#PytorchTraining.pytorch_training-279"><span class="linenos">279</span></a>            <span class="n">start_epoch</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining.pytorch_training-280"><a href="#PytorchTraining.pytorch_training-280"><span class="linenos">280</span></a>
</span><span id="PytorchTraining.pytorch_training-281"><a href="#PytorchTraining.pytorch_training-281"><span class="linenos">281</span></a>        <span class="c1"># history_score is used to keep track of the evolution of training loss and validation loss</span>
</span><span id="PytorchTraining.pytorch_training-282"><a href="#PytorchTraining.pytorch_training-282"><span class="linenos">282</span></a>        <span class="n">history_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span> <span class="o">-</span> <span class="n">start_epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="PytorchTraining.pytorch_training-283"><a href="#PytorchTraining.pytorch_training-283"><span class="linenos">283</span></a>
</span><span id="PytorchTraining.pytorch_training-284"><a href="#PytorchTraining.pytorch_training-284"><span class="linenos">284</span></a>
</span><span id="PytorchTraining.pytorch_training-285"><a href="#PytorchTraining.pytorch_training-285"><span class="linenos">285</span></a>        <span class="c1"># We begin the real and proper training of the network. In the outer cycle we consider the epochs and for each</span>
</span><span id="PytorchTraining.pytorch_training-286"><a href="#PytorchTraining.pytorch_training-286"><span class="linenos">286</span></a>        <span class="c1"># epochs until termination we consider all the batches</span>
</span><span id="PytorchTraining.pytorch_training-287"><a href="#PytorchTraining.pytorch_training-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_epoch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span><span class="p">):</span>
</span><span id="PytorchTraining.pytorch_training-288"><a href="#PytorchTraining.pytorch_training-288"><span class="linenos">288</span></a>
</span><span id="PytorchTraining.pytorch_training-289"><a href="#PytorchTraining.pytorch_training-289"><span class="linenos">289</span></a>            <span class="k">if</span> <span class="n">epochs_without_decrease</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_patience</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-290"><a href="#PytorchTraining.pytorch_training-290"><span class="linenos">290</span></a>                <span class="k">break</span>
</span><span id="PytorchTraining.pytorch_training-291"><a href="#PytorchTraining.pytorch_training-291"><span class="linenos">291</span></a>
</span><span id="PytorchTraining.pytorch_training-292"><a href="#PytorchTraining.pytorch_training-292"><span class="linenos">292</span></a>            <span class="c1"># We set all the values of the network to double.</span>
</span><span id="PytorchTraining.pytorch_training-293"><a href="#PytorchTraining.pytorch_training-293"><span class="linenos">293</span></a>            <span class="c1"># net.pytorch_network.double()</span>
</span><span id="PytorchTraining.pytorch_training-294"><a href="#PytorchTraining.pytorch_training-294"><span class="linenos">294</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-295"><a href="#PytorchTraining.pytorch_training-295"><span class="linenos">295</span></a>            <span class="c1"># We set the network to train mode.</span>
</span><span id="PytorchTraining.pytorch_training-296"><a href="#PytorchTraining.pytorch_training-296"><span class="linenos">296</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-297"><a href="#PytorchTraining.pytorch_training-297"><span class="linenos">297</span></a>            <span class="n">avg_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining.pytorch_training-298"><a href="#PytorchTraining.pytorch_training-298"><span class="linenos">298</span></a>
</span><span id="PytorchTraining.pytorch_training-299"><a href="#PytorchTraining.pytorch_training-299"><span class="linenos">299</span></a>            <span class="c1"># For each batch we compute one learning step</span>
</span><span id="PytorchTraining.pytorch_training-300"><a href="#PytorchTraining.pytorch_training-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
</span><span id="PytorchTraining.pytorch_training-301"><a href="#PytorchTraining.pytorch_training-301"><span class="linenos">301</span></a>
</span><span id="PytorchTraining.pytorch_training-302"><a href="#PytorchTraining.pytorch_training-302"><span class="linenos">302</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-303"><a href="#PytorchTraining.pytorch_training-303"><span class="linenos">303</span></a>                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-304"><a href="#PytorchTraining.pytorch_training-304"><span class="linenos">304</span></a>                    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-305"><a href="#PytorchTraining.pytorch_training-305"><span class="linenos">305</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-306"><a href="#PytorchTraining.pytorch_training-306"><span class="linenos">306</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-307"><a href="#PytorchTraining.pytorch_training-307"><span class="linenos">307</span></a>                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-308"><a href="#PytorchTraining.pytorch_training-308"><span class="linenos">308</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-309"><a href="#PytorchTraining.pytorch_training-309"><span class="linenos">309</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-310"><a href="#PytorchTraining.pytorch_training-310"><span class="linenos">310</span></a>                <span class="n">avg_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-311"><a href="#PytorchTraining.pytorch_training-311"><span class="linenos">311</span></a>                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-312"><a href="#PytorchTraining.pytorch_training-312"><span class="linenos">312</span></a>
</span><span id="PytorchTraining.pytorch_training-313"><a href="#PytorchTraining.pytorch_training-313"><span class="linenos">313</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-314"><a href="#PytorchTraining.pytorch_training-314"><span class="linenos">314</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">network_transform</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-315"><a href="#PytorchTraining.pytorch_training-315"><span class="linenos">315</span></a>
</span><span id="PytorchTraining.pytorch_training-316"><a href="#PytorchTraining.pytorch_training-316"><span class="linenos">316</span></a>                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-317"><a href="#PytorchTraining.pytorch_training-317"><span class="linenos">317</span></a>
</span><span id="PytorchTraining.pytorch_training-318"><a href="#PytorchTraining.pytorch_training-318"><span class="linenos">318</span></a>                <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-319"><a href="#PytorchTraining.pytorch_training-319"><span class="linenos">319</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Train Epoch: </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{:.1f}</span><span class="s1">%)]</span><span class="se">\t</span><span class="s1">Loss: </span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PytorchTraining.pytorch_training-320"><a href="#PytorchTraining.pytorch_training-320"><span class="linenos">320</span></a>                        <span class="n">epoch</span><span class="p">,</span> <span class="n">batch_idx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="p">),</span>
</span><span id="PytorchTraining.pytorch_training-321"><a href="#PytorchTraining.pytorch_training-321"><span class="linenos">321</span></a>                               <span class="mf">100.</span> <span class="o">*</span> <span class="n">batch_idx</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_batch_size</span><span class="p">),</span>
</span><span id="PytorchTraining.pytorch_training-322"><a href="#PytorchTraining.pytorch_training-322"><span class="linenos">322</span></a>                        <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span><span id="PytorchTraining.pytorch_training-323"><a href="#PytorchTraining.pytorch_training-323"><span class="linenos">323</span></a>
</span><span id="PytorchTraining.pytorch_training-324"><a href="#PytorchTraining.pytorch_training-324"><span class="linenos">324</span></a>            <span class="c1"># avg_loss = avg_loss / float(math.floor(len(training_set) / self.train_batch_size))</span>
</span><span id="PytorchTraining.pytorch_training-325"><a href="#PytorchTraining.pytorch_training-325"><span class="linenos">325</span></a>            <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">avg_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="PytorchTraining.pytorch_training-326"><a href="#PytorchTraining.pytorch_training-326"><span class="linenos">326</span></a>            <span class="n">history_score</span><span class="p">[</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_loss</span>
</span><span id="PytorchTraining.pytorch_training-327"><a href="#PytorchTraining.pytorch_training-327"><span class="linenos">327</span></a>
</span><span id="PytorchTraining.pytorch_training-328"><a href="#PytorchTraining.pytorch_training-328"><span class="linenos">328</span></a>            <span class="c1"># EPOCH TEST</span>
</span><span id="PytorchTraining.pytorch_training-329"><a href="#PytorchTraining.pytorch_training-329"><span class="linenos">329</span></a>
</span><span id="PytorchTraining.pytorch_training-330"><a href="#PytorchTraining.pytorch_training-330"><span class="linenos">330</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-331"><a href="#PytorchTraining.pytorch_training-331"><span class="linenos">331</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-332"><a href="#PytorchTraining.pytorch_training-332"><span class="linenos">332</span></a>            <span class="n">validation_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining.pytorch_training-333"><a href="#PytorchTraining.pytorch_training-333"><span class="linenos">333</span></a>            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="PytorchTraining.pytorch_training-334"><a href="#PytorchTraining.pytorch_training-334"><span class="linenos">334</span></a>
</span><span id="PytorchTraining.pytorch_training-335"><a href="#PytorchTraining.pytorch_training-335"><span class="linenos">335</span></a>                <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">validation_loader</span><span class="p">):</span>
</span><span id="PytorchTraining.pytorch_training-336"><a href="#PytorchTraining.pytorch_training-336"><span class="linenos">336</span></a>
</span><span id="PytorchTraining.pytorch_training-337"><a href="#PytorchTraining.pytorch_training-337"><span class="linenos">337</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-338"><a href="#PytorchTraining.pytorch_training-338"><span class="linenos">338</span></a>                    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-339"><a href="#PytorchTraining.pytorch_training-339"><span class="linenos">339</span></a>                        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-340"><a href="#PytorchTraining.pytorch_training-340"><span class="linenos">340</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-341"><a href="#PytorchTraining.pytorch_training-341"><span class="linenos">341</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-342"><a href="#PytorchTraining.pytorch_training-342"><span class="linenos">342</span></a>                    <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-343"><a href="#PytorchTraining.pytorch_training-343"><span class="linenos">343</span></a>                    <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision_metric</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-344"><a href="#PytorchTraining.pytorch_training-344"><span class="linenos">344</span></a>                    <span class="n">validation_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-345"><a href="#PytorchTraining.pytorch_training-345"><span class="linenos">345</span></a>
</span><span id="PytorchTraining.pytorch_training-346"><a href="#PytorchTraining.pytorch_training-346"><span class="linenos">346</span></a>            <span class="c1"># validation_loss = validation_loss / float(math.floor(len(validation_set) / self.validation_batch_size))</span>
</span><span id="PytorchTraining.pytorch_training-347"><a href="#PytorchTraining.pytorch_training-347"><span class="linenos">347</span></a>            <span class="n">validation_loss</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="PytorchTraining.pytorch_training-348"><a href="#PytorchTraining.pytorch_training-348"><span class="linenos">348</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Validation Set Metric Value: </span><span class="si">{:.4f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">validation_loss</span><span class="p">))</span>
</span><span id="PytorchTraining.pytorch_training-349"><a href="#PytorchTraining.pytorch_training-349"><span class="linenos">349</span></a>
</span><span id="PytorchTraining.pytorch_training-350"><a href="#PytorchTraining.pytorch_training-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">validation_loss</span> <span class="o">&lt;</span> <span class="n">best_loss_score</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-351"><a href="#PytorchTraining.pytorch_training-351"><span class="linenos">351</span></a>                <span class="n">epochs_without_decrease</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTraining.pytorch_training-352"><a href="#PytorchTraining.pytorch_training-352"><span class="linenos">352</span></a>                <span class="n">best_loss_score</span> <span class="o">=</span> <span class="n">validation_loss</span>
</span><span id="PytorchTraining.pytorch_training-353"><a href="#PytorchTraining.pytorch_training-353"><span class="linenos">353</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-354"><a href="#PytorchTraining.pytorch_training-354"><span class="linenos">354</span></a>                <span class="n">epochs_without_decrease</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PytorchTraining.pytorch_training-355"><a href="#PytorchTraining.pytorch_training-355"><span class="linenos">355</span></a>
</span><span id="PytorchTraining.pytorch_training-356"><a href="#PytorchTraining.pytorch_training-356"><span class="linenos">356</span></a>            <span class="c1"># We need to distinguish among different scheduler because not all the pytorch scheduler present the same</span>
</span><span id="PytorchTraining.pytorch_training-357"><a href="#PytorchTraining.pytorch_training-357"><span class="linenos">357</span></a>            <span class="c1"># interface.</span>
</span><span id="PytorchTraining.pytorch_training-358"><a href="#PytorchTraining.pytorch_training-358"><span class="linenos">358</span></a>            <span class="k">if</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-359"><a href="#PytorchTraining.pytorch_training-359"><span class="linenos">359</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scheduler</span><span class="p">,</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">):</span>
</span><span id="PytorchTraining.pytorch_training-360"><a href="#PytorchTraining.pytorch_training-360"><span class="linenos">360</span></a>                    <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">validation_loss</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-361"><a href="#PytorchTraining.pytorch_training-361"><span class="linenos">361</span></a>                <span class="k">elif</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-362"><a href="#PytorchTraining.pytorch_training-362"><span class="linenos">362</span></a>                    <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="PytorchTraining.pytorch_training-363"><a href="#PytorchTraining.pytorch_training-363"><span class="linenos">363</span></a>
</span><span id="PytorchTraining.pytorch_training-364"><a href="#PytorchTraining.pytorch_training-364"><span class="linenos">364</span></a>            <span class="c1"># CHECKPOINT</span>
</span><span id="PytorchTraining.pytorch_training-365"><a href="#PytorchTraining.pytorch_training-365"><span class="linenos">365</span></a>
</span><span id="PytorchTraining.pytorch_training-366"><a href="#PytorchTraining.pytorch_training-366"><span class="linenos">366</span></a>            <span class="n">history_score</span><span class="p">[</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_loss</span>
</span><span id="PytorchTraining.pytorch_training-367"><a href="#PytorchTraining.pytorch_training-367"><span class="linenos">367</span></a>            <span class="n">is_best</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">&lt;</span> <span class="n">best_loss_score</span>
</span><span id="PytorchTraining.pytorch_training-368"><a href="#PytorchTraining.pytorch_training-368"><span class="linenos">368</span></a>
</span><span id="PytorchTraining.pytorch_training-369"><a href="#PytorchTraining.pytorch_training-369"><span class="linenos">369</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PytorchTraining.pytorch_training-370"><a href="#PytorchTraining.pytorch_training-370"><span class="linenos">370</span></a>                <span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PytorchTraining.pytorch_training-371"><a href="#PytorchTraining.pytorch_training-371"><span class="linenos">371</span></a>                <span class="s1">&#39;network_state_dict&#39;</span><span class="p">:</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span><span id="PytorchTraining.pytorch_training-372"><a href="#PytorchTraining.pytorch_training-372"><span class="linenos">372</span></a>                <span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">:</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span><span id="PytorchTraining.pytorch_training-373"><a href="#PytorchTraining.pytorch_training-373"><span class="linenos">373</span></a>                <span class="s1">&#39;best_loss_score&#39;</span><span class="p">:</span> <span class="n">best_loss_score</span><span class="p">,</span>
</span><span id="PytorchTraining.pytorch_training-374"><a href="#PytorchTraining.pytorch_training-374"><span class="linenos">374</span></a>                <span class="s1">&#39;epochs_without_decrease&#39;</span><span class="p">:</span> <span class="n">epochs_without_decrease</span>
</span><span id="PytorchTraining.pytorch_training-375"><a href="#PytorchTraining.pytorch_training-375"><span class="linenos">375</span></a>            <span class="p">}</span>
</span><span id="PytorchTraining.pytorch_training-376"><a href="#PytorchTraining.pytorch_training-376"><span class="linenos">376</span></a>
</span><span id="PytorchTraining.pytorch_training-377"><a href="#PytorchTraining.pytorch_training-377"><span class="linenos">377</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">checkpoints_path</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-378"><a href="#PytorchTraining.pytorch_training-378"><span class="linenos">378</span></a>            <span class="k">if</span> <span class="n">is_best</span><span class="p">:</span>
</span><span id="PytorchTraining.pytorch_training-379"><a href="#PytorchTraining.pytorch_training-379"><span class="linenos">379</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">,</span> <span class="n">best_model_path</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-380"><a href="#PytorchTraining.pytorch_training-380"><span class="linenos">380</span></a>
</span><span id="PytorchTraining.pytorch_training-381"><a href="#PytorchTraining.pytorch_training-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">):</span>
</span><span id="PytorchTraining.pytorch_training-382"><a href="#PytorchTraining.pytorch_training-382"><span class="linenos">382</span></a>            <span class="n">best_checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-383"><a href="#PytorchTraining.pytorch_training-383"><span class="linenos">383</span></a>            <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">best_checkpoint</span><span class="p">[</span><span class="s1">&#39;network_state_dict&#39;</span><span class="p">])</span>
</span><span id="PytorchTraining.pytorch_training-384"><a href="#PytorchTraining.pytorch_training-384"><span class="linenos">384</span></a>
</span><span id="PytorchTraining.pytorch_training-385"><a href="#PytorchTraining.pytorch_training-385"><span class="linenos">385</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Loss Score: </span><span class="si">{</span><span class="n">best_loss_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PytorchTraining.pytorch_training-386"><a href="#PytorchTraining.pytorch_training-386"><span class="linenos">386</span></a>
</span><span id="PytorchTraining.pytorch_training-387"><a href="#PytorchTraining.pytorch_training-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="n">net</span>
</span></pre></div>


            <div class="docstring"><p>Training procedure for the PyTorchNetwork.</p>

<h2 id="parameters">Parameters</h2>

<p>net : PyTorchNetwork
    The PyTorchNetwork to train.
dataset : Dataset
    The dataset to use for the training of the PyTorchNetwork</p>

<h2 id="returns">Returns</h2>

<p>PyTorchNetwork
    The trained PyTorchNetwork.</p>
</div>


                            </div>
                </section>
                <section id="PytorchTesting">
                            <input id="PytorchTesting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PytorchTesting</span><wbr>(<span class="base"><a href="#TestingStrategy">TestingStrategy</a></span>):

                <label class="view-source-button" for="PytorchTesting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTesting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTesting-390"><a href="#PytorchTesting-390"><span class="linenos">390</span></a><span class="k">class</span> <span class="nc">PytorchTesting</span><span class="p">(</span><span class="n">TestingStrategy</span><span class="p">):</span>
</span><span id="PytorchTesting-391"><a href="#PytorchTesting-391"><span class="linenos">391</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PytorchTesting-392"><a href="#PytorchTesting-392"><span class="linenos">392</span></a><span class="sd">    Class used to represent the testing strategy based on the Pytorch learning framework.</span>
</span><span id="PytorchTesting-393"><a href="#PytorchTesting-393"><span class="linenos">393</span></a><span class="sd">    It supports different metrics measure for the correctness of the neural network.</span>
</span><span id="PytorchTesting-394"><a href="#PytorchTesting-394"><span class="linenos">394</span></a>
</span><span id="PytorchTesting-395"><a href="#PytorchTesting-395"><span class="linenos">395</span></a><span class="sd">    Attributes</span>
</span><span id="PytorchTesting-396"><a href="#PytorchTesting-396"><span class="linenos">396</span></a><span class="sd">    ----------</span>
</span><span id="PytorchTesting-397"><a href="#PytorchTesting-397"><span class="linenos">397</span></a>
</span><span id="PytorchTesting-398"><a href="#PytorchTesting-398"><span class="linenos">398</span></a><span class="sd">    metric : Callable</span>
</span><span id="PytorchTesting-399"><a href="#PytorchTesting-399"><span class="linenos">399</span></a><span class="sd">        Function for measuring the precision/correctness of the neural network.</span>
</span><span id="PytorchTesting-400"><a href="#PytorchTesting-400"><span class="linenos">400</span></a>
</span><span id="PytorchTesting-401"><a href="#PytorchTesting-401"><span class="linenos">401</span></a><span class="sd">    metric_params : Dict</span>
</span><span id="PytorchTesting-402"><a href="#PytorchTesting-402"><span class="linenos">402</span></a><span class="sd">        Supplementary parameters for the metric other than the output and the target (which should always be the first</span>
</span><span id="PytorchTesting-403"><a href="#PytorchTesting-403"><span class="linenos">403</span></a><span class="sd">        two parameters of the metric. It is assumed that it produce a float value and such value</span>
</span><span id="PytorchTesting-404"><a href="#PytorchTesting-404"><span class="linenos">404</span></a><span class="sd">        decrease for increasing correctness of the network (as the traditional loss value).</span>
</span><span id="PytorchTesting-405"><a href="#PytorchTesting-405"><span class="linenos">405</span></a>
</span><span id="PytorchTesting-406"><a href="#PytorchTesting-406"><span class="linenos">406</span></a><span class="sd">    test_batch_size : int</span>
</span><span id="PytorchTesting-407"><a href="#PytorchTesting-407"><span class="linenos">407</span></a><span class="sd">        Dimension for the test batch size for the testing procedure</span>
</span><span id="PytorchTesting-408"><a href="#PytorchTesting-408"><span class="linenos">408</span></a>
</span><span id="PytorchTesting-409"><a href="#PytorchTesting-409"><span class="linenos">409</span></a><span class="sd">    cuda : bool, Optional</span>
</span><span id="PytorchTesting-410"><a href="#PytorchTesting-410"><span class="linenos">410</span></a><span class="sd">        Whether to use the cuda library for the procedure (default: False).</span>
</span><span id="PytorchTesting-411"><a href="#PytorchTesting-411"><span class="linenos">411</span></a>
</span><span id="PytorchTesting-412"><a href="#PytorchTesting-412"><span class="linenos">412</span></a><span class="sd">    save_results : bool, Optional</span>
</span><span id="PytorchTesting-413"><a href="#PytorchTesting-413"><span class="linenos">413</span></a><span class="sd">        Whether to save outputs, targets and losses as attributes.</span>
</span><span id="PytorchTesting-414"><a href="#PytorchTesting-414"><span class="linenos">414</span></a>
</span><span id="PytorchTesting-415"><a href="#PytorchTesting-415"><span class="linenos">415</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PytorchTesting-416"><a href="#PytorchTesting-416"><span class="linenos">416</span></a>
</span><span id="PytorchTesting-417"><a href="#PytorchTesting-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">metric_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">test_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>
</span><span id="PytorchTesting-418"><a href="#PytorchTesting-418"><span class="linenos">418</span></a>                 <span class="n">save_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="PytorchTesting-419"><a href="#PytorchTesting-419"><span class="linenos">419</span></a>
</span><span id="PytorchTesting-420"><a href="#PytorchTesting-420"><span class="linenos">420</span></a>        <span class="n">TestingStrategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="PytorchTesting-421"><a href="#PytorchTesting-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
</span><span id="PytorchTesting-422"><a href="#PytorchTesting-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric_params</span> <span class="o">=</span> <span class="n">metric_params</span>
</span><span id="PytorchTesting-423"><a href="#PytorchTesting-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_batch_size</span> <span class="o">=</span> <span class="n">test_batch_size</span>
</span><span id="PytorchTesting-424"><a href="#PytorchTesting-424"><span class="linenos">424</span></a>        <span class="k">assert</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;mps&#39;</span>
</span><span id="PytorchTesting-425"><a href="#PytorchTesting-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTesting-426"><a href="#PytorchTesting-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mps</span> <span class="o">=</span> <span class="n">mps</span>
</span><span id="PytorchTesting-427"><a href="#PytorchTesting-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="n">save_results</span>
</span><span id="PytorchTesting-428"><a href="#PytorchTesting-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="PytorchTesting-429"><a href="#PytorchTesting-429"><span class="linenos">429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PytorchTesting-430"><a href="#PytorchTesting-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PytorchTesting-431"><a href="#PytorchTesting-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PytorchTesting-432"><a href="#PytorchTesting-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTesting-433"><a href="#PytorchTesting-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTesting-434"><a href="#PytorchTesting-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTesting-435"><a href="#PytorchTesting-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTesting-436"><a href="#PytorchTesting-436"><span class="linenos">436</span></a>
</span><span id="PytorchTesting-437"><a href="#PytorchTesting-437"><span class="linenos">437</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="PytorchTesting-438"><a href="#PytorchTesting-438"><span class="linenos">438</span></a>
</span><span id="PytorchTesting-439"><a href="#PytorchTesting-439"><span class="linenos">439</span></a>        <span class="n">pytorch_converter</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchConverter</span><span class="p">()</span>
</span><span id="PytorchTesting-440"><a href="#PytorchTesting-440"><span class="linenos">440</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="n">pytorch_converter</span><span class="o">.</span><span class="n">from_neural_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</span><span id="PytorchTesting-441"><a href="#PytorchTesting-441"><span class="linenos">441</span></a>
</span><span id="PytorchTesting-442"><a href="#PytorchTesting-442"><span class="linenos">442</span></a>        <span class="n">measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_testing</span><span class="p">(</span><span class="n">py_net</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span><span id="PytorchTesting-443"><a href="#PytorchTesting-443"><span class="linenos">443</span></a>
</span><span id="PytorchTesting-444"><a href="#PytorchTesting-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="n">measure</span>
</span><span id="PytorchTesting-445"><a href="#PytorchTesting-445"><span class="linenos">445</span></a>
</span><span id="PytorchTesting-446"><a href="#PytorchTesting-446"><span class="linenos">446</span></a>    <span class="k">def</span> <span class="nf">pytorch_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="PytorchTesting-447"><a href="#PytorchTesting-447"><span class="linenos">447</span></a>
</span><span id="PytorchTesting-448"><a href="#PytorchTesting-448"><span class="linenos">448</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTesting-449"><a href="#PytorchTesting-449"><span class="linenos">449</span></a>
</span><span id="PytorchTesting-450"><a href="#PytorchTesting-450"><span class="linenos">450</span></a>        <span class="c1"># We set all the values of the network to double.</span>
</span><span id="PytorchTesting-451"><a href="#PytorchTesting-451"><span class="linenos">451</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTesting-452"><a href="#PytorchTesting-452"><span class="linenos">452</span></a>
</span><span id="PytorchTesting-453"><a href="#PytorchTesting-453"><span class="linenos">453</span></a>        <span class="c1"># We instantiate the data loader</span>
</span><span id="PytorchTesting-454"><a href="#PytorchTesting-454"><span class="linenos">454</span></a>        <span class="n">test_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_batch_size</span><span class="p">)</span>
</span><span id="PytorchTesting-455"><a href="#PytorchTesting-455"><span class="linenos">455</span></a>
</span><span id="PytorchTesting-456"><a href="#PytorchTesting-456"><span class="linenos">456</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="PytorchTesting-457"><a href="#PytorchTesting-457"><span class="linenos">457</span></a>        <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTesting-458"><a href="#PytorchTesting-458"><span class="linenos">458</span></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="PytorchTesting-459"><a href="#PytorchTesting-459"><span class="linenos">459</span></a>
</span><span id="PytorchTesting-460"><a href="#PytorchTesting-460"><span class="linenos">460</span></a>            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">):</span>
</span><span id="PytorchTesting-461"><a href="#PytorchTesting-461"><span class="linenos">461</span></a>
</span><span id="PytorchTesting-462"><a href="#PytorchTesting-462"><span class="linenos">462</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTesting-463"><a href="#PytorchTesting-463"><span class="linenos">463</span></a>                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="PytorchTesting-464"><a href="#PytorchTesting-464"><span class="linenos">464</span></a>                    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTesting-465"><a href="#PytorchTesting-465"><span class="linenos">465</span></a>
</span><span id="PytorchTesting-466"><a href="#PytorchTesting-466"><span class="linenos">466</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTesting-467"><a href="#PytorchTesting-467"><span class="linenos">467</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTesting-468"><a href="#PytorchTesting-468"><span class="linenos">468</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="PytorchTesting-469"><a href="#PytorchTesting-469"><span class="linenos">469</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_params</span><span class="p">)</span>
</span><span id="PytorchTesting-470"><a href="#PytorchTesting-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">:</span>
</span><span id="PytorchTesting-471"><a href="#PytorchTesting-471"><span class="linenos">471</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="PytorchTesting-472"><a href="#PytorchTesting-472"><span class="linenos">472</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="PytorchTesting-473"><a href="#PytorchTesting-473"><span class="linenos">473</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="PytorchTesting-474"><a href="#PytorchTesting-474"><span class="linenos">474</span></a>                <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="PytorchTesting-475"><a href="#PytorchTesting-475"><span class="linenos">475</span></a>
</span><span id="PytorchTesting-476"><a href="#PytorchTesting-476"><span class="linenos">476</span></a>        <span class="c1"># test_loss = test_loss / float(math.floor(len(dataset)) / self.test_batch_size)</span>
</span><span id="PytorchTesting-477"><a href="#PytorchTesting-477"><span class="linenos">477</span></a>        <span class="n">test_loss</span> <span class="o">=</span> <span class="n">test_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="PytorchTesting-478"><a href="#PytorchTesting-478"><span class="linenos">478</span></a>
</span><span id="PytorchTesting-479"><a href="#PytorchTesting-479"><span class="linenos">479</span></a>        <span class="k">return</span> <span class="n">test_loss</span>
</span></pre></div>


            <div class="docstring"><p>Class used to represent the testing strategy based on the Pytorch learning framework.
It supports different metrics measure for the correctness of the neural network.</p>

<h2 id="attributes">Attributes</h2>

<p>metric : Callable
    Function for measuring the precision/correctness of the neural network.</p>

<p>metric_params : Dict
    Supplementary parameters for the metric other than the output and the target (which should always be the first
    two parameters of the metric. It is assumed that it produce a float value and such value
    decrease for increasing correctness of the network (as the traditional loss value).</p>

<p>test_batch_size : int
    Dimension for the test batch size for the testing procedure</p>

<p>cuda : bool, Optional
    Whether to use the cuda library for the procedure (default: False).</p>

<p>save_results : bool, Optional
    Whether to save outputs, targets and losses as attributes.</p>
</div>


                            <div id="PytorchTesting.__init__" class="classattr">
                                        <input id="PytorchTesting.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PytorchTesting</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">metric</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="n">metric_params</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">test_batch_size</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span>,</span><span class="param">	<span class="n">save_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">mps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="PytorchTesting.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTesting.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTesting.__init__-417"><a href="#PytorchTesting.__init__-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">metric_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">test_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>
</span><span id="PytorchTesting.__init__-418"><a href="#PytorchTesting.__init__-418"><span class="linenos">418</span></a>                 <span class="n">save_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="PytorchTesting.__init__-419"><a href="#PytorchTesting.__init__-419"><span class="linenos">419</span></a>
</span><span id="PytorchTesting.__init__-420"><a href="#PytorchTesting.__init__-420"><span class="linenos">420</span></a>        <span class="n">TestingStrategy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="PytorchTesting.__init__-421"><a href="#PytorchTesting.__init__-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
</span><span id="PytorchTesting.__init__-422"><a href="#PytorchTesting.__init__-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric_params</span> <span class="o">=</span> <span class="n">metric_params</span>
</span><span id="PytorchTesting.__init__-423"><a href="#PytorchTesting.__init__-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_batch_size</span> <span class="o">=</span> <span class="n">test_batch_size</span>
</span><span id="PytorchTesting.__init__-424"><a href="#PytorchTesting.__init__-424"><span class="linenos">424</span></a>        <span class="k">assert</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cpu&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">or</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;mps&#39;</span>
</span><span id="PytorchTesting.__init__-425"><a href="#PytorchTesting.__init__-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTesting.__init__-426"><a href="#PytorchTesting.__init__-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mps</span> <span class="o">=</span> <span class="n">mps</span>
</span><span id="PytorchTesting.__init__-427"><a href="#PytorchTesting.__init__-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="n">save_results</span>
</span><span id="PytorchTesting.__init__-428"><a href="#PytorchTesting.__init__-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
</span><span id="PytorchTesting.__init__-429"><a href="#PytorchTesting.__init__-429"><span class="linenos">429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PytorchTesting.__init__-430"><a href="#PytorchTesting.__init__-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PytorchTesting.__init__-431"><a href="#PytorchTesting.__init__-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PytorchTesting.__init__-432"><a href="#PytorchTesting.__init__-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PytorchTesting.__init__-433"><a href="#PytorchTesting.__init__-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTesting.__init__-434"><a href="#PytorchTesting.__init__-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchTesting.__init__-435"><a href="#PytorchTesting.__init__-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="PytorchTesting.metric" class="classattr">
                                <div class="attr variable">
            <span class="name">metric</span>

        
    </div>
    <a class="headerlink" href="#PytorchTesting.metric"></a>
    
    

                            </div>
                            <div id="PytorchTesting.metric_params" class="classattr">
                                <div class="attr variable">
            <span class="name">metric_params</span>

        
    </div>
    <a class="headerlink" href="#PytorchTesting.metric_params"></a>
    
    

                            </div>
                            <div id="PytorchTesting.test_batch_size" class="classattr">
                                <div class="attr variable">
            <span class="name">test_batch_size</span>

        
    </div>
    <a class="headerlink" href="#PytorchTesting.test_batch_size"></a>
    
    

                            </div>
                            <div id="PytorchTesting.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span>

        
    </div>
    <a class="headerlink" href="#PytorchTesting.device"></a>
    
    

                            </div>
                            <div id="PytorchTesting.mps" class="classattr">
                                <div class="attr variable">
            <span class="name">mps</span>

        
    </div>
    <a class="headerlink" href="#PytorchTesting.mps"></a>
    
    

                            </div>
                            <div id="PytorchTesting.save_results" class="classattr">
                                <div class="attr variable">
            <span class="name">save_results</span>

        
    </div>
    <a class="headerlink" href="#PytorchTesting.save_results"></a>
    
    

                            </div>
                            <div id="PytorchTesting.test" class="classattr">
                                        <input id="PytorchTesting.test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">network</span><span class="p">:</span> <span class="n"><a href="../networks.html#NeuralNetwork">pynever.networks.NeuralNetwork</a></span>,</span><span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="n"><a href="../datasets.html#Dataset">pynever.datasets.Dataset</a></span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="PytorchTesting.test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTesting.test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTesting.test-437"><a href="#PytorchTesting.test-437"><span class="linenos">437</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">networks</span><span class="o">.</span><span class="n">NeuralNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="PytorchTesting.test-438"><a href="#PytorchTesting.test-438"><span class="linenos">438</span></a>
</span><span id="PytorchTesting.test-439"><a href="#PytorchTesting.test-439"><span class="linenos">439</span></a>        <span class="n">pytorch_converter</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchConverter</span><span class="p">()</span>
</span><span id="PytorchTesting.test-440"><a href="#PytorchTesting.test-440"><span class="linenos">440</span></a>        <span class="n">py_net</span> <span class="o">=</span> <span class="n">pytorch_converter</span><span class="o">.</span><span class="n">from_neural_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</span><span id="PytorchTesting.test-441"><a href="#PytorchTesting.test-441"><span class="linenos">441</span></a>
</span><span id="PytorchTesting.test-442"><a href="#PytorchTesting.test-442"><span class="linenos">442</span></a>        <span class="n">measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_testing</span><span class="p">(</span><span class="n">py_net</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span><span id="PytorchTesting.test-443"><a href="#PytorchTesting.test-443"><span class="linenos">443</span></a>
</span><span id="PytorchTesting.test-444"><a href="#PytorchTesting.test-444"><span class="linenos">444</span></a>        <span class="k">return</span> <span class="n">measure</span>
</span></pre></div>


            <div class="docstring"><p>Test the neural network of interest using a testing strategy determined in the concrete children.</p>

<h2 id="parameters">Parameters</h2>

<p>network : NeuralNetwork
    The neural network to test.
dataset : Dataset
    The dataset to use to test the neural network.</p>

<h2 id="returns">Returns</h2>

<p>float
    A measure of the correctness of the networks dependant on the concrete children</p>
</div>


                            </div>
                            <div id="PytorchTesting.pytorch_testing" class="classattr">
                                        <input id="PytorchTesting.pytorch_testing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pytorch_testing</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">net</span><span class="p">:</span> <span class="n"><a href="conversion.html#PyTorchNetwork">pynever.strategies.conversion.PyTorchNetwork</a></span>,</span><span class="param">	<span class="n">dataset</span><span class="p">:</span> <span class="n"><a href="../datasets.html#Dataset">pynever.datasets.Dataset</a></span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="PytorchTesting.pytorch_testing-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchTesting.pytorch_testing"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchTesting.pytorch_testing-446"><a href="#PytorchTesting.pytorch_testing-446"><span class="linenos">446</span></a>    <span class="k">def</span> <span class="nf">pytorch_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">PyTorchNetwork</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="PytorchTesting.pytorch_testing-447"><a href="#PytorchTesting.pytorch_testing-447"><span class="linenos">447</span></a>
</span><span id="PytorchTesting.pytorch_testing-448"><a href="#PytorchTesting.pytorch_testing-448"><span class="linenos">448</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTesting.pytorch_testing-449"><a href="#PytorchTesting.pytorch_testing-449"><span class="linenos">449</span></a>
</span><span id="PytorchTesting.pytorch_testing-450"><a href="#PytorchTesting.pytorch_testing-450"><span class="linenos">450</span></a>        <span class="c1"># We set all the values of the network to double.</span>
</span><span id="PytorchTesting.pytorch_testing-451"><a href="#PytorchTesting.pytorch_testing-451"><span class="linenos">451</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTesting.pytorch_testing-452"><a href="#PytorchTesting.pytorch_testing-452"><span class="linenos">452</span></a>
</span><span id="PytorchTesting.pytorch_testing-453"><a href="#PytorchTesting.pytorch_testing-453"><span class="linenos">453</span></a>        <span class="c1"># We instantiate the data loader</span>
</span><span id="PytorchTesting.pytorch_testing-454"><a href="#PytorchTesting.pytorch_testing-454"><span class="linenos">454</span></a>        <span class="n">test_loader</span> <span class="o">=</span> <span class="n">tdt</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_batch_size</span><span class="p">)</span>
</span><span id="PytorchTesting.pytorch_testing-455"><a href="#PytorchTesting.pytorch_testing-455"><span class="linenos">455</span></a>
</span><span id="PytorchTesting.pytorch_testing-456"><a href="#PytorchTesting.pytorch_testing-456"><span class="linenos">456</span></a>        <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="PytorchTesting.pytorch_testing-457"><a href="#PytorchTesting.pytorch_testing-457"><span class="linenos">457</span></a>        <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PytorchTesting.pytorch_testing-458"><a href="#PytorchTesting.pytorch_testing-458"><span class="linenos">458</span></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="PytorchTesting.pytorch_testing-459"><a href="#PytorchTesting.pytorch_testing-459"><span class="linenos">459</span></a>
</span><span id="PytorchTesting.pytorch_testing-460"><a href="#PytorchTesting.pytorch_testing-460"><span class="linenos">460</span></a>            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">):</span>
</span><span id="PytorchTesting.pytorch_testing-461"><a href="#PytorchTesting.pytorch_testing-461"><span class="linenos">461</span></a>
</span><span id="PytorchTesting.pytorch_testing-462"><a href="#PytorchTesting.pytorch_testing-462"><span class="linenos">462</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTesting.pytorch_testing-463"><a href="#PytorchTesting.pytorch_testing-463"><span class="linenos">463</span></a>                <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">:</span>
</span><span id="PytorchTesting.pytorch_testing-464"><a href="#PytorchTesting.pytorch_testing-464"><span class="linenos">464</span></a>                    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="PytorchTesting.pytorch_testing-465"><a href="#PytorchTesting.pytorch_testing-465"><span class="linenos">465</span></a>
</span><span id="PytorchTesting.pytorch_testing-466"><a href="#PytorchTesting.pytorch_testing-466"><span class="linenos">466</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">target</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="PytorchTesting.pytorch_testing-467"><a href="#PytorchTesting.pytorch_testing-467"><span class="linenos">467</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchTesting.pytorch_testing-468"><a href="#PytorchTesting.pytorch_testing-468"><span class="linenos">468</span></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">pytorch_network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="PytorchTesting.pytorch_testing-469"><a href="#PytorchTesting.pytorch_testing-469"><span class="linenos">469</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_params</span><span class="p">)</span>
</span><span id="PytorchTesting.pytorch_testing-470"><a href="#PytorchTesting.pytorch_testing-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_results</span><span class="p">:</span>
</span><span id="PytorchTesting.pytorch_testing-471"><a href="#PytorchTesting.pytorch_testing-471"><span class="linenos">471</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="PytorchTesting.pytorch_testing-472"><a href="#PytorchTesting.pytorch_testing-472"><span class="linenos">472</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="PytorchTesting.pytorch_testing-473"><a href="#PytorchTesting.pytorch_testing-473"><span class="linenos">473</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="PytorchTesting.pytorch_testing-474"><a href="#PytorchTesting.pytorch_testing-474"><span class="linenos">474</span></a>                <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="PytorchTesting.pytorch_testing-475"><a href="#PytorchTesting.pytorch_testing-475"><span class="linenos">475</span></a>
</span><span id="PytorchTesting.pytorch_testing-476"><a href="#PytorchTesting.pytorch_testing-476"><span class="linenos">476</span></a>        <span class="c1"># test_loss = test_loss / float(math.floor(len(dataset)) / self.test_batch_size)</span>
</span><span id="PytorchTesting.pytorch_testing-477"><a href="#PytorchTesting.pytorch_testing-477"><span class="linenos">477</span></a>        <span class="n">test_loss</span> <span class="o">=</span> <span class="n">test_loss</span> <span class="o">/</span> <span class="n">batch_idx</span>
</span><span id="PytorchTesting.pytorch_testing-478"><a href="#PytorchTesting.pytorch_testing-478"><span class="linenos">478</span></a>
</span><span id="PytorchTesting.pytorch_testing-479"><a href="#PytorchTesting.pytorch_testing-479"><span class="linenos">479</span></a>        <span class="k">return</span> <span class="n">test_loss</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="PytorchMetrics">
                            <input id="PytorchMetrics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PytorchMetrics</span>:

                <label class="view-source-button" for="PytorchMetrics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchMetrics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchMetrics-482"><a href="#PytorchMetrics-482"><span class="linenos">482</span></a><span class="k">class</span> <span class="nc">PytorchMetrics</span><span class="p">:</span>
</span><span id="PytorchMetrics-483"><a href="#PytorchMetrics-483"><span class="linenos">483</span></a>
</span><span id="PytorchMetrics-484"><a href="#PytorchMetrics-484"><span class="linenos">484</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PytorchMetrics-485"><a href="#PytorchMetrics-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="nf">inaccuracy</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="PytorchMetrics-486"><a href="#PytorchMetrics-486"><span class="linenos">486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PytorchMetrics-487"><a href="#PytorchMetrics-487"><span class="linenos">487</span></a><span class="sd">        Function to compute the inaccuracy of a prediction. It assumes that the task is classification, the output is</span>
</span><span id="PytorchMetrics-488"><a href="#PytorchMetrics-488"><span class="linenos">488</span></a><span class="sd">        a Tensor of shape (n, d) where d is the number of possible classes. The target is a Tensor of shape (n, 1) of</span>
</span><span id="PytorchMetrics-489"><a href="#PytorchMetrics-489"><span class="linenos">489</span></a><span class="sd">        int whose elements correspond to the correct class for the n-th sample. The index of the output element with</span>
</span><span id="PytorchMetrics-490"><a href="#PytorchMetrics-490"><span class="linenos">490</span></a><span class="sd">        the greater value (considering the n-th Tensor) correspond to the class predicted. We consider the inaccuracy</span>
</span><span id="PytorchMetrics-491"><a href="#PytorchMetrics-491"><span class="linenos">491</span></a><span class="sd">        metric instead than the accuracy because our metric functions must follow the rule: &quot;lower value equals to</span>
</span><span id="PytorchMetrics-492"><a href="#PytorchMetrics-492"><span class="linenos">492</span></a><span class="sd">        better network&quot; like the loss functions.</span>
</span><span id="PytorchMetrics-493"><a href="#PytorchMetrics-493"><span class="linenos">493</span></a>
</span><span id="PytorchMetrics-494"><a href="#PytorchMetrics-494"><span class="linenos">494</span></a><span class="sd">        Parameters</span>
</span><span id="PytorchMetrics-495"><a href="#PytorchMetrics-495"><span class="linenos">495</span></a><span class="sd">        ----------</span>
</span><span id="PytorchMetrics-496"><a href="#PytorchMetrics-496"><span class="linenos">496</span></a><span class="sd">        output : torch.Tensor</span>
</span><span id="PytorchMetrics-497"><a href="#PytorchMetrics-497"><span class="linenos">497</span></a><span class="sd">            Output predicted by the network. It should be a Tensor of shape (n, d)</span>
</span><span id="PytorchMetrics-498"><a href="#PytorchMetrics-498"><span class="linenos">498</span></a><span class="sd">        target : torch.Tensor</span>
</span><span id="PytorchMetrics-499"><a href="#PytorchMetrics-499"><span class="linenos">499</span></a><span class="sd">            Correct class for the prediction. It should be a Tensor of shape (n, 1)</span>
</span><span id="PytorchMetrics-500"><a href="#PytorchMetrics-500"><span class="linenos">500</span></a>
</span><span id="PytorchMetrics-501"><a href="#PytorchMetrics-501"><span class="linenos">501</span></a><span class="sd">        Returns</span>
</span><span id="PytorchMetrics-502"><a href="#PytorchMetrics-502"><span class="linenos">502</span></a><span class="sd">        -------</span>
</span><span id="PytorchMetrics-503"><a href="#PytorchMetrics-503"><span class="linenos">503</span></a><span class="sd">        float</span>
</span><span id="PytorchMetrics-504"><a href="#PytorchMetrics-504"><span class="linenos">504</span></a><span class="sd">            Number of correct prediction / number of sample analyzed</span>
</span><span id="PytorchMetrics-505"><a href="#PytorchMetrics-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PytorchMetrics-506"><a href="#PytorchMetrics-506"><span class="linenos">506</span></a>
</span><span id="PytorchMetrics-507"><a href="#PytorchMetrics-507"><span class="linenos">507</span></a>        <span class="n">pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PytorchMetrics-508"><a href="#PytorchMetrics-508"><span class="linenos">508</span></a>        <span class="n">acc</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_as</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchMetrics-509"><a href="#PytorchMetrics-509"><span class="linenos">509</span></a>        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">acc</span>
</span></pre></div>


    

                            <div id="PytorchMetrics.inaccuracy" class="classattr">
                                        <input id="PytorchMetrics.inaccuracy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">inaccuracy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">output</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">target</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="PytorchMetrics.inaccuracy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchMetrics.inaccuracy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchMetrics.inaccuracy-484"><a href="#PytorchMetrics.inaccuracy-484"><span class="linenos">484</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PytorchMetrics.inaccuracy-485"><a href="#PytorchMetrics.inaccuracy-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="nf">inaccuracy</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="PytorchMetrics.inaccuracy-486"><a href="#PytorchMetrics.inaccuracy-486"><span class="linenos">486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PytorchMetrics.inaccuracy-487"><a href="#PytorchMetrics.inaccuracy-487"><span class="linenos">487</span></a><span class="sd">        Function to compute the inaccuracy of a prediction. It assumes that the task is classification, the output is</span>
</span><span id="PytorchMetrics.inaccuracy-488"><a href="#PytorchMetrics.inaccuracy-488"><span class="linenos">488</span></a><span class="sd">        a Tensor of shape (n, d) where d is the number of possible classes. The target is a Tensor of shape (n, 1) of</span>
</span><span id="PytorchMetrics.inaccuracy-489"><a href="#PytorchMetrics.inaccuracy-489"><span class="linenos">489</span></a><span class="sd">        int whose elements correspond to the correct class for the n-th sample. The index of the output element with</span>
</span><span id="PytorchMetrics.inaccuracy-490"><a href="#PytorchMetrics.inaccuracy-490"><span class="linenos">490</span></a><span class="sd">        the greater value (considering the n-th Tensor) correspond to the class predicted. We consider the inaccuracy</span>
</span><span id="PytorchMetrics.inaccuracy-491"><a href="#PytorchMetrics.inaccuracy-491"><span class="linenos">491</span></a><span class="sd">        metric instead than the accuracy because our metric functions must follow the rule: &quot;lower value equals to</span>
</span><span id="PytorchMetrics.inaccuracy-492"><a href="#PytorchMetrics.inaccuracy-492"><span class="linenos">492</span></a><span class="sd">        better network&quot; like the loss functions.</span>
</span><span id="PytorchMetrics.inaccuracy-493"><a href="#PytorchMetrics.inaccuracy-493"><span class="linenos">493</span></a>
</span><span id="PytorchMetrics.inaccuracy-494"><a href="#PytorchMetrics.inaccuracy-494"><span class="linenos">494</span></a><span class="sd">        Parameters</span>
</span><span id="PytorchMetrics.inaccuracy-495"><a href="#PytorchMetrics.inaccuracy-495"><span class="linenos">495</span></a><span class="sd">        ----------</span>
</span><span id="PytorchMetrics.inaccuracy-496"><a href="#PytorchMetrics.inaccuracy-496"><span class="linenos">496</span></a><span class="sd">        output : torch.Tensor</span>
</span><span id="PytorchMetrics.inaccuracy-497"><a href="#PytorchMetrics.inaccuracy-497"><span class="linenos">497</span></a><span class="sd">            Output predicted by the network. It should be a Tensor of shape (n, d)</span>
</span><span id="PytorchMetrics.inaccuracy-498"><a href="#PytorchMetrics.inaccuracy-498"><span class="linenos">498</span></a><span class="sd">        target : torch.Tensor</span>
</span><span id="PytorchMetrics.inaccuracy-499"><a href="#PytorchMetrics.inaccuracy-499"><span class="linenos">499</span></a><span class="sd">            Correct class for the prediction. It should be a Tensor of shape (n, 1)</span>
</span><span id="PytorchMetrics.inaccuracy-500"><a href="#PytorchMetrics.inaccuracy-500"><span class="linenos">500</span></a>
</span><span id="PytorchMetrics.inaccuracy-501"><a href="#PytorchMetrics.inaccuracy-501"><span class="linenos">501</span></a><span class="sd">        Returns</span>
</span><span id="PytorchMetrics.inaccuracy-502"><a href="#PytorchMetrics.inaccuracy-502"><span class="linenos">502</span></a><span class="sd">        -------</span>
</span><span id="PytorchMetrics.inaccuracy-503"><a href="#PytorchMetrics.inaccuracy-503"><span class="linenos">503</span></a><span class="sd">        float</span>
</span><span id="PytorchMetrics.inaccuracy-504"><a href="#PytorchMetrics.inaccuracy-504"><span class="linenos">504</span></a><span class="sd">            Number of correct prediction / number of sample analyzed</span>
</span><span id="PytorchMetrics.inaccuracy-505"><a href="#PytorchMetrics.inaccuracy-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PytorchMetrics.inaccuracy-506"><a href="#PytorchMetrics.inaccuracy-506"><span class="linenos">506</span></a>
</span><span id="PytorchMetrics.inaccuracy-507"><a href="#PytorchMetrics.inaccuracy-507"><span class="linenos">507</span></a>        <span class="n">pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PytorchMetrics.inaccuracy-508"><a href="#PytorchMetrics.inaccuracy-508"><span class="linenos">508</span></a>        <span class="n">acc</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_as</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="PytorchMetrics.inaccuracy-509"><a href="#PytorchMetrics.inaccuracy-509"><span class="linenos">509</span></a>        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">acc</span>
</span></pre></div>


            <div class="docstring"><p>Function to compute the inaccuracy of a prediction. It assumes that the task is classification, the output is
a Tensor of shape (n, d) where d is the number of possible classes. The target is a Tensor of shape (n, 1) of
int whose elements correspond to the correct class for the n-th sample. The index of the output element with
the greater value (considering the n-th Tensor) correspond to the class predicted. We consider the inaccuracy
metric instead than the accuracy because our metric functions must follow the rule: "lower value equals to
better network" like the loss functions.</p>

<h2 id="parameters">Parameters</h2>

<p>output : torch.Tensor
    Output predicted by the network. It should be a Tensor of shape (n, d)
target : torch.Tensor
    Correct class for the prediction. It should be a Tensor of shape (n, 1)</p>

<h2 id="returns">Returns</h2>

<p>float
    Number of correct prediction / number of sample analyzed</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>